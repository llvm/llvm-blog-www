<!doctype html><html lang=en>
<head>
<title>Clang/LLVM on Windows Update - The LLVM Project Blog</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="LLVM Project News and Details from the Trenches">
<meta name=author content="Warren Hunt"><meta property="og:title" content="Clang/LLVM on Windows Update">
<meta property="og:description" content="It’s time for an update on Clang’s support for building native Windows programs, compatible with Visual C++! &nbsp;We’ve been working hard over the last few months and have improved the toolchain in a variety of ways.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.llvm.org/2014/07/clangllvm-on-windows-update.html"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-07-07T20:34:00+00:00">
<meta property="article:modified_time" content="2014-07-07T20:34:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Clang/LLVM on Windows Update">
<meta name=twitter:description content="It’s time for an update on Clang’s support for building native Windows programs, compatible with Visual C++! &nbsp;We’ve been working hard over the last few months and have improved the toolchain in a variety of ways.">
<meta name=generator content="Hugo 0.89.4">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous>
<link rel=stylesheet href=https://blog.llvm.org/fontawesome/css/all.min.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda">
<link rel=stylesheet type=text/css href=https://blog.llvm.org/css/styles.css></head>
<body>
<div id=container>
<header>
<h1>
<a href=https://blog.llvm.org/>The LLVM Project Blog</a>
</h1>
<ul id=social-media>
<li>
<a href=https://www.facebook.com/llvmorg title=Facebook>
<i class="fab fa-facebook fa-lg"></i>
</a>
</li>
<li>
<a href=https://github.com/llvm title=GitHub>
<i class="fab fa-github fa-lg"></i>
</a>
</li>
<li>
<a href=https://twitter.com/llvmorg title=Twitter>
<i class="fab fa-twitter fa-lg"></i>
</a>
</li>
<li>
<a href=https://www.youtube.com/c/LLVMPROJ title=Youtube>
<i class="fab fa-youtube fa-lg"></i>
</a>
</li>
</ul>
<p><em>LLVM Project News and Details from the Trenches</em></p>
</header>
<nav>
<ul>
<li>
<a href=https://blog.llvm.org/about>
<i class="fa-li fa fa-lg"></i><span>About</span>
</a>
</li>
<li>
<a href=https://blog.llvm.org/posts>
<i class="fa-li fa fa-lg"></i><span>Posts</span>
</a>
</li>
<li>
<a href=https://blog.llvm.org/tags>
<i class="fa-li fa fa-lg"></i><span>Tags</span>
</a>
</li>
<li>
<a href=https://llvm.org/>
<i class="fa-li fa fa-lg"></i><span>llvm.org</span>
</a>
</li>
</ul>
</nav>
<main>
<article>
<h1>Clang/LLVM on Windows Update</h1>
<aside>
<ul>
<li>
<time class=post-date datetime=2014-07-07T20:34:00Z>Jul 7, 2014</time>
</li>
<li>
<em>
<a href=https://blog.llvm.org/tags/clang>#Clang</a>
,
<a href=https://blog.llvm.org/tags/windows>#Windows</a>
</em>
</li>
<li>2 minute read</li>
</ul>
</aside>
<div dir=ltr style=line-height:1.15;margin-bottom:0;margin-top:0><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap>It’s time for an update on Clang’s support for building native Windows programs, compatible with Visual C++! &nbsp;We’ve been working hard over the last few months and have improved the toolchain in a variety of ways. &nbsp;All C++ features aside from debug info and exceptions should work well. &nbsp;This </span><a href=http://clang.llvm.org/docs/MSVCCompatibility.html style=text-decoration:none><span style=background-color:transparent;color:#15c;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>link</span></a><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap> provide more specific details. &nbsp;In February we reached an exciting milestone that we can self-host Clang and LLVM using clang-cl (without fallback), and both projects &nbsp;pass all of their tests! &nbsp;Additionally both Chrome and Firefox now compile successfully with fallback! &nbsp;Here are some of the highlights of recent improvements:</span></div><b id=docs-internal-guid-2b2f973e-119b-7120-2d4c-138311c64483 style=font-weight:400><br></b><br><div dir=ltr style=line-height:1.15;margin-bottom:0;margin-top:0><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap>Microsoft compatible record layout is done! &nbsp;It’s been thoroughly fuzz tested and supports all Microsoft specific components such as virtual base table pointers, </span><a href=http://msdn.microsoft.com/en-us/library/453x4xdd.aspx style=text-decoration:none><span style=background-color:transparent;color:#15c;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>vtordisps</span></a><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap>, __declspec(align) and #pragma pack. &nbsp;This turned out to be a major effort due to subtle interactions between various features. &nbsp;For example, __declspec(align) and #pragma pack behave in an analogous manner to the gcc variants, but interact with each other in a different manner. Each version of Visual Studio changes the ABI slightly. &nbsp;As of today clang-cl is layout compatible with VS2013.</span></div><b style=font-weight:400><br></b><br><div dir=ltr style=line-height:1.15;margin-bottom:0;margin-top:0><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap>Clang now supports all of the calling conventions used up to VS2012. &nbsp;VS2013 added some new ones that we haven’t implemented yet. &nbsp;One of the other major compatibility challenges we overcame was passing C++ objects by value on 32-bit x86. &nbsp;Prior to this effort, LLVM modeled all outgoing arguments as SSA values, making it impossible to take the address of an argument to a call. &nbsp;It turns out that on Windows C++ objects passed by value are constructed directly into the argument memory used for the function call. &nbsp;Achieving 100% compatibility in this area required making fundamental changes to LLVM IR to allow us to compute this address.</span></div><b style=font-weight:400><br></b><br><div dir=ltr style=line-height:1.15;margin-bottom:0;margin-top:0><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap>Most recently support for run time type information (RTTI) was completed. &nbsp;With RTTI support, a larger set of programs and libraries (for example </span><a href=http://site.icu-project.org/ style=text-decoration:none><span style=background-color:transparent;color:#15c;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>ICU</span></a><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap>) compile without fallback and dynamic_cast and typeid both work. &nbsp;RTTI support also brings along support for std::function. &nbsp;We also recently added support for lambdas so you can enjoy all of the C++11 functional goodness!</span></div><br><div dir=ltr style=line-height:1.15;margin-bottom:0;margin-top:0><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap>We invite you to </span><a href=http://llvm.org/builds/ style=text-decoration:none><span style=background-color:transparent;color:#15c;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>try it out for yourself</span></a><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap> and, as always, we encourage everyone to file bugs!</span></div>
</article>
<section class=post-nav>
<ul>
<li>
<a href=https://blog.llvm.org/2014/07/llvm-weekly-27-jul-7th-2014.html><i class="fa fa-chevron-circle-left"></i> LLVM Weekly - #27, Jul 7th 2014</a>
</li>
<li>
<a href=https://blog.llvm.org/2014/07/llvm-weekly-28-jul-14th-2014.html>LLVM Weekly - #28, Jul 14th 2014 <i class="fa fa-chevron-circle-right"></i> </a>
</li>
</ul>
</section>
</main>
<footer>
<ul>
<li>
<h6>llvm.org |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://blog.llvm.org/index.xml>Subscribe </a></h6>
</li>
</ul>
</footer>
</div>
<script src=https://blog.llvm.org/js/scripts.js></script>
</body>
</html>