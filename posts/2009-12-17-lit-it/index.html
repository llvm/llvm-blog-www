<!doctype html><html lang=en><head><title>The LLVM Project Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="LLVM Project News and Details from the Trenches"><meta name=author content="Daniel Dunbar"><meta property="og:title" content="'lit' it"><meta property="og:description" content="If you've been watching LLVM and Clang, you'll notice that there is a new testing tool we are using called lit. Clang has already moved to it, and LLVM has support for it (DejaGNU is still the default, but is being phased out)."><meta property="og:type" content="article"><meta property="og:url" content="https://new-blog.llvm.org/posts/2009-12-17-lit-it/"><meta property="article:published_time" content="2009-12-17T20:11:00+00:00"><meta property="article:modified_time" content="2009-12-17T20:11:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="'lit' it"><meta name=twitter:description content="If you've been watching LLVM and Clang, you'll notice that there is a new testing tool we are using called lit. Clang has already moved to it, and LLVM has support for it (DejaGNU is still the default, but is being phased out)."><meta name=generator content="Hugo 0.68.3"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://new-blog.llvm.org/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=https://new-blog.llvm.org/css/styles.css></head><body><div id=container><header><h1><a href=https://new-blog.llvm.org/>The LLVM Project Blog</a></h1><ul id=social-media><li><a href=https://www.facebook.com/llvmorg title=Facebook><i class="fab fa-facebook fa-lg"></i></a></li><li><a href=https://github.com/llvm title=GitHub><i class="fab fa-github fa-lg"></i></a></li><li><a href=https://twitter.com/llvmorg title=Twitter><i class="fab fa-twitter fa-lg"></i></a></li><li><a href=https://www.youtube.com/c/LLVMPROJ title=Youtube><i class="fab fa-youtube fa-lg"></i></a></li></ul><p><em>LLVM Project News and Details from the Trenches</em></p></header><nav><ul><li><a href=https://new-blog.llvm.org/about><i class="fa-li fa fa-lg"></i><span>About</span></a></li><li><a href=https://new-blog.llvm.org/posts><i class="fa-li fa fa-lg"></i><span>Posts</span></a></li><li><a href=https://new-blog.llvm.org/tags><i class="fa-li fa fa-lg"></i><span>Tags</span></a></li><li><a href=https://llvm.org/><i class="fa-li fa fa-lg"></i><span>llvm.org</span></a></li></ul></nav><main><article><h1>'lit' it</h1><aside><ul><li><time class=post-date datetime=2009-12-17T20:11:00Z>Dec 17, 2009</time></li><li>Daniel Dunbar</li><li><em><a href=https://new-blog.llvm.org/tags/testing>#testing</a></em></li><li>4 minutes read</li></ul></aside><div>If you've been watching LLVM and Clang, you'll notice that there is a new testing tool we are using called <b>lit</b>. Clang has already moved to it, and LLVM has support for it (DejaGNU is still the default, but is being phased out). I thought I'd write a little bit about why I wrote <b>lit</b>, what it is, and how it will make your life better. :)<br></div><div><br><a name=more></a><br><br></div><div>First, let me summarize the pre-<b>lit</b> background:<br></div><div><ul><li>LLVM used <a href=http://www.gnu.org/software/dejagnu/>DejaGNU</a> and <a href=http://code.google.com/p/googletest/>googletest</a> unit tests. Our usage of DejaGNU was pretty limited though, what we really used was a test format which embedded shell scripts inside each test file. Our DejaGNU harness would interpret those commands, substitute a few variables, run them, and check the exit status. The googletest unit tests were run separately, and frequently forgotten.</li><li>Clang used a similar looking -- but completely different -- infrastructure which still had embedded shell scripts, but ran them via <b>make</b> and <b>sed</b>. It had the notable advantage of running tests in parallel and being significantly simpler, but not particularly flexible.</li></ul><div>One thing both systems had in common was that it was very easy to add a new test, usually a couple lines in a file in the appropriate directory. But there were some annoying cons:<br></div><div><ul><li>There was no way to run tests via CMake or on Windows.</li><li>LLVM tests weren't run in parallel.</li><li>The UI to the tests was inconsistent and cumbersome (especially for DejaGNU, which would required invoking the LLVM Makefile via a shell script, which then invoked DejaGNU's runtest command).</li></ul><div>I didn't actually set out to write a new testing tool -- <b>lit </b>started because I had a need to run a very large number of "tests", which was just a fixed script to run with many different inputs. I hacked up a quick multithreaded Python test runner for it, and over time it grew a progress bar and more features. Later, when there was growing interest in having Clang work on Windows I wrote a Python based interpreter for the scripts (remember, they amounted to just shell scripts, so <b>lit</b> has what amounts to a little (ba)<b>sh</b> lexer and parser hiding in it). It didn't take a lot of imagination to put the two together and feature creep it until it could replace DejaGNU (yeah, it has a tiny Tcl parser too).<br></div><div><br></div><div>So, what <i>is </i><b>lit</b>? Strictly speaking, <b>lit</b> is a test running infrastructure, like DejaGNU. Its primary job is to find tests, execute them, and report the results to the user; it just happens to have built in support for the LLVM and Clang test formats. My number one design goal was that <b>lit</b> should "just work" whenever possible -- running a test should be as easy as<br></div><pre><b>$ lit exprs.s</b><br>lit: lit.cfg:94: note: using out-of-tree build at '/Volumes/Data/ddunbar/llvm.obj.64'<br>-- Testing: 1 tests, 2 threads --<br>PASS: LLVM::MC/AsmParser/exprs.s (1 of 1)<br>Testing Time: 0.06s<br>Expected Passes    : 1<br></pre><div>no matter if you are using an in-tree or out-of-tree build, testing Clang or LLVM, a regression test or googletest based unit test, on Windows or Unix, and so on. And of course I also wanted it to be fast!<br></div><div><br></div><div>I'm not going to go into more detail on how to use <b>lit</b> (since it should be self explanatory or documented) but these are some of the features and benefits we've gotten from switching to <b>lit</b>:<br></div><div><ul><li>LLVM tests run much faster, this improved our buildbot build/test cycle on a fast machine by about 25%, if I recall correctly. I still have a secret desire to make them even faster... one day...</li><li>Clang tests work on Windows and have been incorporated into our buildbot. There is still work to be done on LLVM tests.</li><li>LLVM/Clang tests work in CMake builds (with Makefiles, Xcode, and Visual Studio generators).</li><li><b>lit</b> integrates nicely into buildbot, so individual failures get split out into their own log. I hope to continue to improve the UI for diagnosing failures.</li><li>The LLVM googletest based unit tests are seamlessly integrated with the other tests. In fact, when using the standard LLVM Makefiles, its possibly to run all LLVM & Clang tests with just <tt>make check-all</tt>.</li><li>We're using some of the fancier <b>lit</b> features to help with C++ testing. For example, we have custom test suites which run <tt>clang -fsyntax-only</tt> over libstdc++ and the LLVM/Clang headers to test the parser, or which run <tt>clang -c</tt> over the LLVM and Clang C++ code to test Clang's C++ code generation. I secretly suspect Doug of having more <b>lit </b>test suites hiding on his hard drive.</li><li>And I have more improvements in store...</li></ul></div><div>You can read the <b>lit</b> man page <a href=http://llvm.org/cmds/lit.html>here</a>, and I hope to add more information to the LLVM <a href=http://llvm.org/docs/TestingGuide.html>Testing Guide</a> once all the pieces are fully in place. Try it out, I hope you like it!<br></div><div><br></div><div>- Daniel<br></div><div><br></div><div>p.s. <b>lit</b> stands for LLVM Integrated Tester, at least thats what I publicly claim. That, or it's the first three letter pronounceable name I came up with...<br></div></div></div></article><section class=post-nav><ul><li><a href=https://new-blog.llvm.org/posts/2009-12-14-tag-specific-rss-feed/><i class="fa fa-chevron-circle-left"></i>Welcome to the LLVM Blog</a></li><li><a href=https://new-blog.llvm.org/posts/2009-12-17-introduction-to-load-elimination-in-gvn/>Introduction to load elimination in the GVN pass <i class="fa fa-chevron-circle-right"></i></a></li></ul></section></main><footer><h6>llvm.org |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://new-blog.llvm.org/index.xml>Subscribe</a></h6></footer></div><script src=https://new-blog.llvm.org/js/scripts.js></script></body></html>