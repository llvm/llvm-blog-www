<!doctype html><html lang=en>
<head>
<title>GSoC 2024: GPU Libc Benchmarking - The LLVM Project Blog</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="LLVM Project News and Details from the Trenches">
<meta name=author content="James Hu"><meta property="og:title" content="GSoC 2024: GPU Libc Benchmarking">
<meta property="og:description" content="Hey everyone! My name is James and I worked on LLVM this summer through GSoC. My project is called GPU Libc Benchmarking. The main objective of this project was to develop microbenchmarking infrastructure for libc on the GPU.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.llvm.org/posts/2024-08-09-libc-gpu-benchmarking/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2024-08-09T00:00:00+00:00">
<meta property="article:modified_time" content="2024-08-09T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="GSoC 2024: GPU Libc Benchmarking">
<meta name=twitter:description content="Hey everyone! My name is James and I worked on LLVM this summer through GSoC. My project is called GPU Libc Benchmarking. The main objective of this project was to develop microbenchmarking infrastructure for libc on the GPU.">
<meta name=generator content="Hugo 0.89.4">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous>
<link rel=stylesheet href=https://blog.llvm.org/fontawesome/css/all.min.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda">
<link rel=stylesheet type=text/css href=https://blog.llvm.org/css/styles.css></head>
<body>
<div id=container>
<header>
<h1>
<a href=https://blog.llvm.org/>The LLVM Project Blog</a>
</h1>
<ul id=social-media>
<li>
<a href=https://www.facebook.com/llvmorg title=Facebook>
<i class="fab fa-facebook fa-lg"></i>
</a>
</li>
<li>
<a href=https://github.com/llvm title=GitHub>
<i class="fab fa-github fa-lg"></i>
</a>
</li>
<li>
<a href=https://twitter.com/llvmorg title=Twitter>
<i class="fab fa-twitter fa-lg"></i>
</a>
</li>
<li>
<a href=https://www.youtube.com/c/LLVMPROJ title=Youtube>
<i class="fab fa-youtube fa-lg"></i>
</a>
</li>
</ul>
<p><em>LLVM Project News and Details from the Trenches</em></p>
</header>
<nav>
<ul>
<li>
<a href=https://blog.llvm.org/about>
<i class="fa-li fa fa-lg"></i><span>About</span>
</a>
</li>
<li>
<a href=https://blog.llvm.org/posts>
<i class="fa-li fa fa-lg"></i><span>Posts</span>
</a>
</li>
<li>
<a href=https://blog.llvm.org/tags>
<i class="fa-li fa fa-lg"></i><span>Tags</span>
</a>
</li>
<li>
<a href=https://llvm.org/>
<i class="fa-li fa fa-lg"></i><span>llvm.org</span>
</a>
</li>
</ul>
</nav>
<main>
<article>
<h1>GSoC 2024: GPU Libc Benchmarking</h1>
<aside>
<ul>
<li>By James Hu</li>
<li>
<time class=post-date datetime=2024-08-09T00:00:00Z>Aug 9, 2024</time>
</li>
<li>
<em>
<a href=https://blog.llvm.org/tags/gsoc>#GSoC</a>
,
<a href=https://blog.llvm.org/tags/libc>#libc</a>
,
<a href=https://blog.llvm.org/tags/gpu>#gpu</a>
</em>
</li>
<li>4 minute read</li>
</ul>
</aside>
<p>Hey everyone! My name is James and I worked on LLVM this summer through GSoC. My project is called <a href=https://summerofcode.withgoogle.com/programs/2024/projects/HkRoz49I>GPU Libc Benchmarking</a>. The main objective of this project was to develop microbenchmarking infrastructure for libc on the GPU.</p>
<h1 id=background>Background</h1>
<p>The LLVM libc project was designed as an alternative to glibc that aims to be modular, configurable, and sanitizer-friendly. Currently, LLVM libc is being ported to Nvidia and AMD GPUs to give libc functionality (e.g. printf(), malloc(), and math functions) on the GPU. As of March 2024, programs can use GPU libc in offloading languages (CUDA, OpenMP) or through direct compilation and linking with the libc library.</p>
<h1 id=what-we-did>What We Did</h1>
<p>During this project, we developed a microbenchmarking framework that is directly compiled for and run on the GPU, using libc functions to display output to the user. As this was a short project (90 hours), we mostly focused on developing the infrastructure and writing a few example usages (isalnum(), isalpha(), and sin()).</p>
<p>Our benchmarking infrastructure is based on Google Benchmark and measures the average cycles, minimum, maximum, and standard deviation of each benchmark. Each benchmark is run for multiple iterations to stabilize the results. Benchmark writers can measure against vendor implementations of libc functions by passing specific linking flags to the benchmarkâ€™s CMake portion and registering the corresponding vendor function from the benchmark itself.</p>
<p>Below is an example of our benchmarking infrastructure&rsquo;s output for <code>sinf()</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>Benchmark            <span style=color:#f92672>|</span>  Cycles <span style=color:#f92672>|</span>     Min <span style=color:#f92672>|</span>     Max <span style=color:#f92672>|</span> Iterations <span style=color:#f92672>|</span> Time <span style=color:#f92672>/</span> Iteration <span style=color:#f92672>|</span>   Stddev <span style=color:#f92672>|</span>  Threads <span style=color:#f92672>|</span>
<span style=color:#f92672>----------------------------------------------------------------------------------------------------------</span>
Sinf_1               <span style=color:#f92672>|</span>     <span style=color:#ae81ff>764</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>369</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2101</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>273</span> <span style=color:#f92672>|</span>             <span style=color:#ae81ff>7</span> us <span style=color:#f92672>|</span>      <span style=color:#ae81ff>323</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
Sinf_128             <span style=color:#f92672>|</span>     <span style=color:#ae81ff>721</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>699</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>744</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>           <span style=color:#ae81ff>913</span> us <span style=color:#f92672>|</span>       <span style=color:#ae81ff>16</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
Sinf_1024            <span style=color:#f92672>|</span>     <span style=color:#ae81ff>661</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>650</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>689</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>9</span> <span style=color:#f92672>|</span>             <span style=color:#ae81ff>7</span> ms <span style=color:#f92672>|</span>       <span style=color:#ae81ff>31</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
Sinf_4096            <span style=color:#f92672>|</span>     <span style=color:#ae81ff>666</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>663</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>669</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>            <span style=color:#ae81ff>28</span> ms <span style=color:#f92672>|</span>       <span style=color:#ae81ff>28</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfTwoPi_1          <span style=color:#f92672>|</span>     <span style=color:#ae81ff>372</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>369</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>632</span> <span style=color:#f92672>|</span>         <span style=color:#ae81ff>70</span> <span style=color:#f92672>|</span>             <span style=color:#ae81ff>7</span> us <span style=color:#f92672>|</span>       <span style=color:#ae81ff>39</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfTwoPi_128        <span style=color:#f92672>|</span>     <span style=color:#ae81ff>379</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>379</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>379</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span>           <span style=color:#ae81ff>895</span> us <span style=color:#f92672>|</span>        <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfTwoPi_1024       <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>338</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>             <span style=color:#ae81ff>7</span> ms <span style=color:#f92672>|</span>       <span style=color:#ae81ff>20</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfTwoPi_4096       <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span>            <span style=color:#ae81ff>28</span> ms <span style=color:#f92672>|</span>        <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfTwoPow30_1       <span style=color:#f92672>|</span>     <span style=color:#ae81ff>371</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>369</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>510</span> <span style=color:#f92672>|</span>         <span style=color:#ae81ff>70</span> <span style=color:#f92672>|</span>             <span style=color:#ae81ff>7</span> us <span style=color:#f92672>|</span>       <span style=color:#ae81ff>17</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfTwoPow30_128     <span style=color:#f92672>|</span>     <span style=color:#ae81ff>379</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>379</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>379</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span>           <span style=color:#ae81ff>894</span> us <span style=color:#f92672>|</span>        <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfTwoPow30_1024    <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>338</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>             <span style=color:#ae81ff>7</span> ms <span style=color:#f92672>|</span>       <span style=color:#ae81ff>20</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfTwoPow30_4096    <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>335</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span>            <span style=color:#ae81ff>28</span> ms <span style=color:#f92672>|</span>        <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfVeryLarge_1      <span style=color:#f92672>|</span>     <span style=color:#ae81ff>477</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>369</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>632</span> <span style=color:#f92672>|</span>         <span style=color:#ae81ff>70</span> <span style=color:#f92672>|</span>             <span style=color:#ae81ff>7</span> us <span style=color:#f92672>|</span>       <span style=color:#ae81ff>58</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfVeryLarge_128    <span style=color:#f92672>|</span>     <span style=color:#ae81ff>487</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>480</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>493</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>           <span style=color:#ae81ff>900</span> us <span style=color:#f92672>|</span>       <span style=color:#ae81ff>14</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfVeryLarge_1024   <span style=color:#f92672>|</span>     <span style=color:#ae81ff>442</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>440</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>447</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>             <span style=color:#ae81ff>7</span> ms <span style=color:#f92672>|</span>       <span style=color:#ae81ff>18</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
SinfVeryLarge_4096   <span style=color:#f92672>|</span>     <span style=color:#ae81ff>441</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>441</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>442</span> <span style=color:#f92672>|</span>          <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span>            <span style=color:#ae81ff>28</span> ms <span style=color:#f92672>|</span>       <span style=color:#ae81ff>14</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>32</span> <span style=color:#f92672>|</span>
</code></pre></div><p>Users can register benchmarks similar to Google Benchmark, using a macro:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>uint64_t</span> <span style=color:#a6e22e>BM_IsAlnumCapital</span>() {
  <span style=color:#66d9ef>char</span> x <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;A&#39;</span>;
  <span style=color:#66d9ef>return</span> LIBC_NAMESPACE<span style=color:#f92672>::</span>latency(LIBC_NAMESPACE<span style=color:#f92672>::</span>isalnum, x);
}
BENCHMARK(LlvmLibcIsAlNumGpuBenchmark, IsAlnumCapital, BM_IsAlnumCapital);
</code></pre></div><h1 id=results>Results</h1>
<p>This project met its major goal of creating microbenchmarking infrastructure for the GPU. However, the original scope of this proposal included a CPU component that would use vendor tools to measure GPU kernel properties. However, this was removed after discussion with the mentors due to technical obstacles in offloading specific kernels to the GPU that would require major changes to other parts of the code.</p>
<h1 id=future-work>Future Work</h1>
<p>As this was a short project (90 hours), we only focused on implementing the microbenchmarking infrastructure. Future contributors can use the benchmarking infrastructure to add additional benchmarks. In addition, there are improvements to microbenchmarking infrastructure that could be added, such as more options for user input ranges, better random distributions for math functions, and a CPU element that can launch multiple kernels and compare results against functions running on the CPU.</p>
<p>The existing code can be found in the <a href=https://github.com/llvm/llvm-project/tree/main/libc/benchmarks/gpu>LLVM repo</a>.</p>
<h1 id=acknowledgements>Acknowledgements</h1>
<p>This project would not have been possible without my amazing mentor, Joseph Huber, the LLVM Foundation admins, and the GSoC admins.</p>
<h1 id=links>Links</h1>
<p><a href="https://github.com/llvm/llvm-project/commits?author=jameshu15869">Landed PRs</a></p>
<p><a href=https://github.com/llvm/llvm-project>LLVM GitHub</a></p>
<p><a href=https://llvm.org/>LLVM Homepage</a></p>
<p><a href=https://summerofcode.withgoogle.com/programs/2024/projects/HkRoz49I>GSoC Project Page</a></p>
</article>
<section class=post-nav>
<ul>
<li>
<a href=https://blog.llvm.org/posts/2024-02-26-gsoc/><i class="fa fa-chevron-circle-left"></i> LLVM Google Summer of Code 2024 & 2023</a>
</li>
<li>
</li>
</ul>
</section>
</main>
<footer>
<ul>
<li>
<h6>llvm.org |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://blog.llvm.org/index.xml>Subscribe </a></h6>
</li>
</ul>
</footer>
</div>
<script src=https://blog.llvm.org/js/scripts.js></script>
</body>
</html>