<!doctype html><html lang=en><head><title>GSoC 2025 - Support simple C++20 modules use from the Clang driver without a build system - The LLVM Project Blog</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="LLVM Project News and Details from the Trenches"><meta name=author content="Naveen Seth Hanig"><meta property="og:url" content="https://blog.llvm.org/posts/2025-08-gsoc-modules-driver/"><meta property="og:site_name" content="The LLVM Project Blog"><meta property="og:title" content="GSoC 2025 - Support simple C++20 modules use from the Clang driver without a build system"><meta property="og:description" content="Hi, my name is Naveen. For Google Summer of Code 2025, I’ve been working on adding native support for simple Clang and C++20 named module use from the Clang driver. This post outlines the project and its current status."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-06T00:00:00+00:00"><meta property="article:modified_time" content="2025-10-06T00:00:00+00:00"><meta property="article:tag" content="Clang"><meta property="article:tag" content="Modules"><meta name=twitter:card content="summary"><meta name=twitter:title content="GSoC 2025 - Support simple C++20 modules use from the Clang driver without a build system"><meta name=twitter:description content="Hi, my name is Naveen. For Google Summer of Code 2025, I’ve been working on adding native support for simple Clang and C++20 named module use from the Clang driver. This post outlines the project and its current status."><meta name=generator content="Hugo 0.128.0"><link rel=stylesheet href=https://blog.llvm.org/css/normalize.min.css><link rel=stylesheet href=https://blog.llvm.org/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=https://blog.llvm.org/css/styles.css></head><body><div id=container><header><h1><a href=https://blog.llvm.org/>The LLVM Project Blog</a></h1><ul id=social-media><li><a href=https://www.facebook.com/llvmorg title=Facebook><i class="fab fa-facebook fa-lg"></i></a></li><li><a href=https://github.com/llvm title=GitHub><i class="fab fa-github fa-lg"></i></a></li><li><a href=https://twitter.com/llvmorg title=Twitter><i class="fab fa-twitter fa-lg"></i></a></li><li><a href=https://www.youtube.com/c/LLVMPROJ title=Youtube><i class="fab fa-youtube fa-lg"></i></a></li></ul><p><em>LLVM Project News and Details from the Trenches</em></p></header><nav><ul><li><a href=https://blog.llvm.org/about><i class="fa-li fa fa-lg"></i><span>About</span></a></li><li><a href=https://blog.llvm.org/posts><i class="fa-li fa fa-lg"></i><span>Posts</span></a></li><li><a href=https://blog.llvm.org/tags><i class="fa-li fa fa-lg"></i><span>Tags</span></a></li><li><a href=https://llvm.org/><i class="fa-li fa fa-lg"></i><span>llvm.org</span></a></li></ul></nav><main><article><h1>GSoC 2025 - Support simple C++20 modules use from the Clang driver without a build system</h1><aside><ul><li>By Naveen Seth Hanig</li><li><time class=post-date datetime=2025-10-06T00:00:00Z>Oct 6, 2025</time></li><li><em><a href=https://blog.llvm.org/tags/clang>#clang</a>
,
<a href=https://blog.llvm.org/tags/modules>#modules</a></em></li><li>5 minute read</li></ul></aside><p>Hi, my name is Naveen. For Google Summer of Code 2025, I’ve been working on adding native support for simple Clang and C++20 named module use from the Clang driver.
This post outlines the project and its current status.</p><p>My mentor for this project was Michael Spencer.</p><h2 id=background>Background</h2><p>Modules solve many of the long-standing problems with the traditional header-based way of sharing code.</p><p>They prevent leaking macros, let you explicitly choose what to export, and can improve compile time at scale.</p><p>However, because modules must be precompiled before use, builds that rely on them need to schedule compilations in the right order, according to their imports.</p><p>At the moment, Clang’s driver lacks native support to do this, which makes even simple tests or tiny programs using modules hard to compile without first setting up a build system.</p><h2 id=goals>Goals</h2><p>The goal of this project is to extend the build system in Clang&rsquo;s driver to natievly support simple use of Clang or C++20 named modules, by integrating Clang&rsquo;s existing support for module dependency scanning.</p><p>This should also support importing the C++ Standard library modules <code>std</code> and <code>std.compat</code>, and add no overhead to cases where modules are not used.</p><p>With the feature fully implemented, the following example should compile without any issue:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> clang++ -std<span style=color:#f92672>=</span>c++23 main.cpp A.cpp -fmodules-driver -fmodules -fmodule-map-file<span style=color:#f92672>=</span>module.modulemap
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>// main.cpp
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;MyLib.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>import std;
</span></span><span style=display:flex><span>import A;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>auto</span> <span style=color:#a6e22e>main</span>() <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>  std<span style=color:#f92672>::</span>println(<span style=color:#e6db74>&#34;{}&#34;</span>, make_greeting(<span style=color:#e6db74>&#34;modules&#34;</span>));
</span></span><span style=display:flex><span>  std<span style=color:#f92672>::</span>println(<span style=color:#e6db74>&#34;The answer is: {}&#34;</span>, get_answer());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>// A.cpp
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> module A;
</span></span><span style=display:flex><span>import std;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>auto</span> <span style=color:#a6e22e>make_greeting</span>(std<span style=color:#f92672>::</span>string_view Name) <span style=color:#f92672>-&gt;</span> std<span style=color:#f92672>::</span>string {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>format(<span style=color:#e6db74>&#34;Hello, {}!&#34;</span>, Name);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>// module.modulemap
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>module MyLib {
</span></span><span style=display:flex><span>  header <span style=color:#e6db74>&#34;MyLib.h&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>export</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>// MyLib.h
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>auto</span> <span style=color:#a6e22e>get_answer</span>() <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>int</span> { <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>42</span>; }
</span></span></code></pre></div><p>Although one of the main advantages of modules is that they can be precompiled once and reused for future uses, support for caching was not included in the scope of this GSoC project.</p><h2 id=design-overview--challenges>Design Overview & Challenges</h2><figure><img src=https://blog.llvm.org/img/gsoc2025-modules-driver-design.webp alt="Modules Driver Design"></figure><h3 id=1-check-enable-the-modules-driver>1. Check: Enable the Modules Driver?</h3><p>Once stabilized, the driver-managed module build feature should be enabled automatically for compilations which make use of C++20 named modules and have two or more source inputs.
To detect named‑module usage without adding noticeable overhead to compilations that don’t use modules, we added a fast scanner that inspects the leading lines of a source input for named module directives only.</p><p>We measured compile times for building Clang with the check enabled and disabled, and profiled it using perf. The benchmarks show that the check typically makes up less than 0.1% of total compile time (<a href=https://github.com/naveen-seth/llvm-dev-cxx-modules-check-benchmark>full benchmarks</a>).</p><h3 id=2-modules-driver-logic>2. Modules Driver Logic</h3><p>At a high level, the modules driver logic can be summarized as simple as:<br>(1) scan, (2) plan the build order, and (3) reorder/modify the jobs.</p><p>Some parts introduced unique challenges:</p><h4 id=handling-of-the-standard-library-modules>Handling of the Standard library modules.</h4><p>Clang’s dependency scanning tooling uses the generated <code>-cc1</code> compilation job&rsquo;s command lines as input. Since we can’t know in advance whether a standard library module will be needed, we always build the jobs for <code>std</code> and <code>std.compat</code>. During the scanning phase, we only scan those standard library modules if a command-line source input depends on them. If a standard library module ends up unused, we drop its job and carefully remove its outputs from the linker command line.</p><h4 id=propagating-scan-diagnostics>Propagating scan diagnostics</h4><p>After completing the dependency scan, we want to forward all diagnostics generated by the scan through the driver&rsquo;s diagnostics engine.
Because those diagnostics are generated outside the driver’s own invocation, they become invalid once the scan process ends.
To prevent this, we serialize each scan diagnostic into an intermediate representation and deserialize it back into a regular diagnostic before emitting it.</p><h2 id=outcome>Outcome</h2><p>The current upstream draft for this feature (see <a href=https://github.com/llvm/llvm-project/pull/156248>here</a>) can successfully compile examples that use both C++20 named modules and Clang modules. Importing Standard Library modules is also supported, and the example above compiles without issues.</p><p>Additionally, the module dependency graph can be emitted as a diagnostic remark (using <code>-Rmodules-driver</code>) in the form of a DOT graph:</p><figure><img src=https://blog.llvm.org/img/gsoc2025-modules-driver-graphviz.svg alt="Modules Driver Graph Remark"></figure><p>Regular translation units are able to import both Clang and C++20 named modules. However, importing a Clang module into a C++20 named module interface unit, or vice versa, is not yet supported.</p><h2 id=future-work>Future work</h2><p>While basic examples using modules compile correctly, there are still many command-line options and input configurations that are incompatible or may break the modules driver in unexpected ways. In the near term, I plan to fix the draft&rsquo;s remaining quirks, land this feature, and make it more robust.</p><p>In addition, the modules driver should gain support for caching precompiled module files, since caching is one of the core strengths of modules and makes up for the initial overhead they add.</p><p>In the longer term, support for imports between different kinds of module units should also be added. Because of the current design of Clang’s dependency scanning tooling, however, allowing C++20 named modules to be imported into Clang modules would require deeper architectural changes.</p><h2 id=acknowledgements>Acknowledgements</h2><p>I’d like to thank my mentor, Michael Spencer, for his invaluable help and guidance, as well as the GSoC and LLVM project admins for making this experience possible.</p><h2 id=links-to-all-prs-and-rfcs>Links to all PRs and RFCs</h2><p>Over the course of this project, I&rsquo;ve submitted the following PRs and RFCs:</p><details><summary>Contributions</summary><p><strong>Project related</strong></p><ul><li><a href=https://github.com/llvm/llvm-project/pull/156248>#156248</a> Add initial support for driver-managed module builds.</li><li><a href=https://github.com/llvm/llvm-project/pull/155450>#155450</a> Relocate previous work due to changes in the modules driver design.</li><li><a href=https://github.com/llvm/llvm-project/pull/149900>#149900</a> Adds scanner to detect C++20 module usage.</li><li><a href=https://github.com/llvm/llvm-project/pull/148674>#148674</a> Fixes a lexing error in the dependency scanning tooling&rsquo;s scanner.</li><li><a href=https://github.com/llvm/llvm-project/pull/148685>#148685</a> Fixes a lexing error in the dependency scanning tooling&rsquo;s scanner.</li><li><a href=https://github.com/llvm/llvm-project/pull/152811>#152811</a> Allow GraphWriter specialization required for DOT graph remark.</li><li><a href=https://github.com/llvm/llvm-project/pull/145857>#145857</a> Adds support for a test for <code>clang-scan-deps</code> on Windows.</li><li><a href=https://github.com/llvm/llvm-project/pull/145221>#145221</a> Adds C++20 named module outputs to the scanning format <code>experimental-full</code> to enable combined scanning of both module kinds.</li><li><a href=https://github.com/llvm/llvm-project/pull/143950>#143950</a> Implements P2223R2 for the dependency scanning tooling&rsquo;s scanner.</li><li><a href=https://github.com/llvm/llvm-project/pull/142455>#142455</a> (NFC) Moves argument handling: Driver::BuildActions -> handleArguments</li><li><a href=https://github.com/llvm/llvm-project/pull/155523>#155523</a> (NFC) Removes dead code in the dependency scanning tooling.</li></ul><p><strong>Misc. contributions</strong></p><ul><li><a href=https://github.com/llvm/llvm-project/pull/145243>#145243</a> Implements P2223R2 for <code>clang-format</code></li><li><a href=https://github.com/llvm/llvm-project/pull/141695>#141230</a> Fixes crash related to octal floating-point literals</li><li><a href=https://github.com/llvm/llvm-project/pull/139457>#139457</a> Fixes crash related to command line handling of source locations.</li></ul></details><details><summary>RFCs</summary><ul><li><a href="https://discourse.llvm.org/t/rfc-modules-support-simple-c-20-modules-use-from-the-clang-driver-without-a-build-system/86456?u=naveen-seth">RFC: Support simple C++20 modules use from the Clang driver without a build system</a></li><li><a href="https://discourse.llvm.org/t/rfc-driver-link-the-driver-against-clangdependencyscanning-clangast-clangfrontend-clangserialization-and-clanglex/87469?u=naveen-seth">RFC: Link the Driver against clangDependencyScanning</a></li></ul></details></article><section class=post-nav><ul><li><a href=https://blog.llvm.org/posts/2025-09-10-bfloat16-in-llvm-libc/><i class="fa fa-chevron-circle-left"></i> GSoC 2025: Bfloat16 in LLVM libc</a></li><li></li></ul></section></main><footer><ul><li><h6>llvm.org |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://blog.llvm.org/index.xml>Subscribe</a></h6></li></ul></footer></div><script src=https://blog.llvm.org/js/scripts.js></script></body></html>