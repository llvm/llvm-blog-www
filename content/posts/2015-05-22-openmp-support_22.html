---
author: Alexey Bataev
blogger_id: tag:blogger.com,1999:blog-6088150582281556517.post-2708589583031097729
blogger_orig_url: http://blog.llvm.org/2015/05/openmp-support_22.html
url: "2015/05/openmp-support_22.html"
date: "2015-05-22T08:23:00Z"
modified_time: "2019-06-10T12:37:05.983-07:00"
tags: ["OpenMP","Clang"]
title: OpenMP Support
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div class="MsoNormal"><span lang="EN-US">OpenMP support in Clang compiler is completed! Every pragma and clause from <a href="http://www.openmp.org/mp-documents/OpenMP3.1.pdf">3.1 version of the standard</a>&nbsp;is supported in full, including combined directives (like ‘#pragma omp parallel for’ and ‘#pragma omp parallel sections’). &nbsp;In addition</span>, some elements of OpenMP 4.0 are supported as well. This includes “almost complete” support for ‘#pragma omp simd” and full support for ‘#pragma omp atomic’ &nbsp;(combined pragmas and a couple of clauses are still missing).</div><div class="MsoNormal"><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">OpenMP enables Clang users to harness full power of modern multi-core processors with vector units. Pragmas from OpenMP 3.1 provide an industry standard way to employ task parallelism, while ‘#pragma omp simd’ is a simple yet flexible way to enable data parallelism (aka vectorization).</span><br /><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">Clang implementation of OpenMP standard relies on LLVM OpenMP runtime library, available at <a href="http://openmp.llvm.org/">http://openmp.llvm.org/</a>. This runtime supports ARM® architecture processors, PowerPC™ processors, 32 and 64 bit X86 processors and provides ABI compatibility with GCC and Intel's existing OpenMP compilers.</span><br /><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">To enable OpenMP, just add ‘<tt>-fopenmp</tt>’ to the command line and provide paths to OpenMP headers and library with ‘<tt>-I &lt;</tt><i>path to omp.h</i><tt>&gt; -L &lt;</tt><i>LLVM OpenMP library path</i><tt>&gt;</tt>’.</span><br /><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">To run a compiled program you may need to provide a path to shared OpenMP library as well:<o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><tt>$ export LD_LIBRARY_PATH=&lt;OpenMP library path&gt;:$LD_LIBRARY_PATH</tt></div>or:<br /><div class="MsoNormal"><tt>$ export DYLD_LIBRARY_PATH=&lt;OpenMP library path&gt;:$DYLD_LIBRARY_PATH</tt></div>on Mac OS X.<br /><br /><div class="MsoNormal"><span lang="EN-US">You can confirm that the compiler works correctly by trying this simple parallel C program:<o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US" style="font-family: &quot;trebuchet ms&quot; , sans-serif;">#include &lt;omp.h&gt;<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US" style="font-family: &quot;trebuchet ms&quot; , sans-serif;">#include &lt;stdio.h&gt;<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US" style="font-family: &quot;trebuchet ms&quot; , sans-serif;">int main() {<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US" style="font-family: &quot;trebuchet ms&quot; , sans-serif;">#pragma omp parallel<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US" style="font-family: &quot;trebuchet ms&quot; , sans-serif;">&nbsp;&nbsp;&nbsp; printf("Hello from thread %d, nthreads %d\n", omp_get_thread_num(), omp_get_num_threads());<o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US"><span style="font-family: &quot;trebuchet ms&quot; , sans-serif;">}</span><o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US">Compile it (you should see no errors or warnings):<o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US" style="font-family: &quot;courier new&quot;; font-size: 10.0pt;"><span style="font-family: &quot;trebuchet ms&quot; , sans-serif;">$ clang -fopenmp -I &lt;path to omp.h&gt; -L &lt;LLVM OpenMP library path&gt; hello_openmp.c -o hello_openmp</span><o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US">and execute: <o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US" style="font-family: &quot;trebuchet ms&quot; , sans-serif; font-size: 10.0pt;">$ <span style="background: white; color: #222222;">export [DY]LD_LIBRARY_PATH=&lt;OpenMP library path&gt;:$[DY]LD_LIBRARY_PATH</span><o:p></o:p></span></div><div class="MsoNormal"><span lang="EN-US" style="font-family: &quot;courier new&quot;; font-size: 10.0pt;"><span style="font-family: &quot;trebuchet ms&quot; , sans-serif;">$ ./hello_openmp</span><o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US">You will see more than one “Hello” line with different thread numbers (note that the lines may be mixed together). If you see only one line, try setting the environment variable OMP_NUM_THREADS to some number (say 4) and try again.</span><br /><span lang="EN-US"><br /></span></div><div class="MsoNormal"><span lang="EN-US">Hopefully, you will enjoy using OpenMP and witness dramatic boosts of your applications’ performance!<o:p></o:p></span></div></div>
