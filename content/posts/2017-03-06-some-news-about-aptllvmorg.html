---
author: Ledru Sylvestre
blogger_id: tag:blogger.com,1999:blog-6088150582281556517.post-4077130601448418376
blogger_orig_url: http://blog.llvm.org/2017/03/some-news-about-aptllvmorg.html
url: "2017/03/some-news-about-aptllvmorg.html"
date: "2017-03-06T12:59:00Z"
modified_time: "2017-03-07T10:59:53.831-08:00"
tags: ["lld","LLDB","apt","Clang","libfuzzer","llvm"]
title: Some news about apt.llvm.org
aliases:
 - /2017/03/some-news-about-aptllvmorg.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><a href="http://apt.llvm.org/">apt.llvm.org</a> provides Debian and Ubuntu repositories for every maintained version of these distributions. LLVM, Clang, clang extra tools, compiler-rt, polly, LLDB and LLD packages are generated for the stable, stabilization and development branches.<br /><br />As it seems that we have more and more users of these packages, I would like to share an update about various recent changes.<br /><h3 style="text-align: left;">New features</h3><h4 style="text-align: left;">LLD<br /><span style="font-weight: normal;">First, the cool new stuff : lld is now proposed and built for i386/amd64 on all Debian and Ubuntu supported versions. The test suite is also executed and the <a href="http://llvm.org/reports/coverage/">coverage results</a> are great. </span></h4><h4 style="text-align: left;">4.0<br /><span style="font-weight: normal;">Then, following the branching for the 4.0 release, I created new repositories to propose this release.</span><br /><span style="font-weight: normal;">For example, for Debian stable, just add the following in <i>/etc/apt/sources.list.d/llvm.list</i></span></h4><blockquote class="tr_bq"><i><span style="font-weight: normal;">deb http://apt.llvm.org/jessie/ llvm-toolchain-jessie-4.0 main</span></i><span style="font-weight: normal;"><i><br />&nbsp; deb-src http://apt.llvm.org/jessie/ llvm-toolchain-jessie main</i></span></blockquote><br /><h4 style="text-align: left;">llvm-defaults<br /><span style="font-weight: normal;">Obviously, the trunk is now 5.0. If llvm-defaults is used, clang, lldb and other meta packages will be automatically updated to this version.</span><br /><span style="font-weight: normal;">As a consequence and also because the branches are dead, 3.7 and 3.8 jobs have been disabled. Please note that both repositories are still available on apt.llvm.org and won't be removed.</span></h4><h4 style="text-align: left;">Zesty: New Ubuntu<br /><span style="font-weight: normal;">Packages for the next Ubuntu 17.04 (zesty) are also generated for 3.9, 4.0 and 5.0.</span></h4><h4 style="text-align: left;">libfuzzer<br /><span style="font-weight: normal;">It has been implemented a few months ago but not clearly communicated. <a href="http://llvm.org/docs/LibFuzzer.html">libfuzzer</a> has also its own packages: libfuzzer-X.Y-dev (example: <i>libfuzzer-3.9-dev,</i> <i>libfuzzer-4.0-dev</i> or <i>libfuzzer-5.0-dev</i>).</span></h4><br /><h3 style="text-align: left;">Changes in the infrastructure</h3><br />In order to support the load, I started to use new blades that Google (thanks again to Nick Lewycky) sponsored for an initiative that I was running for Debian and <a href="https://www.irill.org/">IRILL</a>. The 6 new blades removed all the wait time. With a new salt configuration, I automated the deployment of the slaves. In case the load increases again, we will have access to more blades.<br /><br />I also took the time to fix some long ongoing issues:<br /><ul style="text-align: left;"><li>all repositories are signed and verified that they are&nbsp;&nbsp;&nbsp;&nbsp;</li><li><i>i386</i> and <i>amd64</i> packages are now uploaded at once instead of being uploaded separately. This was causing checksum error when one of the two architectures built correctly and the second was failing (ex: test failing)</li></ul>Last but not least, the <a href="http://llvm.org/reports/coverage/">code coverage results</a> are produced in a more reliable manner.<br /><br /><br /><h3>More information about the implementation and services.</h3>As what is shipped on apt.llvm.org is exactly the same as in Debian and Ubuntu, packaging files are stored on the <a href="https://anonscm.debian.org/viewvc/pkg-llvm/llvm-toolchain/branches/">Debian subversion server.</a><br /><br />A <a href="http://llvm-jenkins.debian.net/">Jenkins instance</a> is in charge of the orchestration of the whole build infrastructure.<br /><br />The trunk packages are built twice a day for every Debian and Ubuntu packages. Branches (3.9 and 4.0 currently) are rebuilt only when the - trigger job found a change. <br /><br />In both case, the Jenkins source job will checkout the Debian SVN branches for their version, checkout/update LLVM/clang/etc repositories and repack everything to create the source tarballs and Debian files (dsc, etc).The completion of job will trigger the binaries job to start. These jobs, thanks to <a href="https://jenkins-debian-glue.org/">Debian Jenkins glue</a> will create or update Debian/Ubuntu versions.<br /><br />Then builds are done the usual way through pbuilder for both i386 and amd64. All the test suites are going to be executed. If any LLVM test is failing on i386 or amd64, the whole build will fail. If both builds and the LLVM testsuite are successful, the sync job will start and rsync packages to the LLVM server to be replicated on the CDN. If one or both builds fail, a notification is sent to the administrator.<br /><br />Some Debian static analysis (<a href="https://packages.debian.org/stretch/lintian">lintian</a>) are executed on the packages to prevent some packaging errors. From time to time, some interesting issues are found.<br /><br />In parallel, some binary builds have some special hooks like <a href="https://scan.coverity.com/projects/llvm">Coverity</a>, <a href="http://llvm.org/reports/coverage/">code coverage</a> or installation of more recent versions of gcc for Ubuntu precise.<br /><br /><h3 style="text-align: left;">Report bugs</h3><div style="text-align: left;"><span style="font-weight: normal;">Bugs can be reported on the <a href="https://bugs.llvm.org//enter_bug.cgi?product=Packaging&amp;component=deb%20packages">bugzilla of the LLVM project</a> in the product "Packaging" and the component "deb packages".</span></div><div style="text-align: left;"><span style="font-weight: normal;">&nbsp;</span>&nbsp;</div><h3 style="text-align: left;">Common issues</h3><div style="text-align: left;">Because packaging quickly moving projects like LLVM or clang, in some cases, this can be challenging to follow the rhythm in particular with regard to tests. For Debian unstable or the latest version of Ubuntu, the matrix is complexified by new versions of the basic pieces of the operating system like gcc/g++ or libtstdc++.<br /><br />This is also not uncommon that some tests are being ignored in the process.</div><h3 style="text-align: left;">How to help</h3><div style="text-align: left;"><br />Some <a href="https://bugs.debian.org/cgi-bin/pkgreport.cgi?include=originator%3Asylvestre;tag=newcomer">new comers bugs</a> are available. As an example:<br /><ul style="text-align: left;"><li><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=751789">Move the compiler-rt libraries</a> into a specific packages to simplify their usage by other packages </li><li><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=813673">Ship libc++</a> as part of llvm-toolchain packages</li><li><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=813672">Ship openmp library</a> as part of llvm-toolchain packages</li><li><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=827185">Full bootstrap of llvm-toolchain</a> (use a clang built during the process)</li><li>... </li></ul>Related to all this, a Google Summer of Code 2017 under the LLVM umbrella has been proposed: <a href="http://llvm.org/OpenProjects.html#apt">Integrate libc++ and OpenMP in apt.llvm.org</a><br /><br />Help is also needed to keep track of the new test failures and get them fixed upstream. For example, a few tests have been marked as <i>expected to fail</i> to avoid crashes.</div></div>
