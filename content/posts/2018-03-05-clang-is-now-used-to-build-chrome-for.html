---
author: Nico Weber
blogger_id: tag:blogger.com,1999:blog-6088150582281556517.post-5767066366284413208
blogger_orig_url: http://blog.llvm.org/2018/03/clang-is-now-used-to-build-chrome-for.html
date: "2018-03-05T12:46:00Z"
modified_time: "2018-03-06T10:54:04.271-08:00"
tags: ["C++","Clang","Products"]
title: Clang is now used to build Chrome for Windows
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: left;">As of Chrome 64, Chrome for Windows is compiled with Clang. We now use Clang to build Chrome for all platforms it runs on: macOS, iOS, Linux, Chrome OS, Android, and Windows. Windows is the platform with the second most Chrome users after Android <a href="http://gs.statcounter.com/browser-version-market-share">according to statcounter</a>, which made this switch particularly exciting.</div><br />Clang is the first-ever open-source C++ compiler that’s ABI-compatible with Microsoft Visual C++ (MSVC) – meaning you can build some parts of your program (for example, system libraries) with the MSVC compiler (“cl.exe”), other parts with Clang, and when linked together (either by MSVC’s linker, “link.exe”, or LLD, the LLVM project’s linker – see below) the parts will form a working program.<br /><br />Note that Clang is not a replacement for Visual Studio, but an addition to it. We still use Microsoft’s headers and libraries to build Chrome, we still use some SDK binaries like midl.exe and mc.exe, and many Chrome/Win developers still use the Visual Studio IDE (for both development and for debugging).<br /><br />This post discusses numbers, motivation, benefits and drawbacks of using Clang instead of MSVC, how to try out Clang for Windows yourself, project history, and next steps. For more information on the technical side you can look at the <a href="https://docs.google.com/presentation/d/1oxNHaVjA9Gn_rTzX6HIpJHP7nXRua_0URXxxJ3oYRq0/edit#slide=id.p">slides of our 2015 LLVM conference talk</a>, and the slides linked from there.<br /><h3>Numbers</h3>This is what most people ask about first, so let’s talk about it first. We think the other sections are more interesting though.<br /><h4 style="text-align: left;">Build time</h4>Building Chrome locally with Clang is about 15% slower than with MSVC. (We’ve heard that Windows Defender can make Clang builds a lot slower on some machines, so if you’re seeing larger slowdowns, make sure to whitelist Clang in Windows Defender.) However, the way Clang emits debug info is more parallelizable and builds with a distributed build service (e.g. <a href="https://chromium.googlesource.com/infra/goma/client/">Goma</a>) are hence faster.<br /><h4 style="text-align: left;">Binary size</h4>Chrome installer size gets smaller for 64-bit builds and slightly larger for 32-bit builds using Clang. The same difference shows in uncompressed code size for regular builds as well (see the <a href="https://crbug.com/457078">tracking bug for Clang binary size</a> for many numbers). However, compared to MSVC builds using link-time code generation (LTCG) and <a href="https://blog.chromium.org/2016/10/making-chrome-on-windows-faster-with-pgo.html">profile-guided optimization</a> (PGO) Clang generates larger code in 64-bit for targets that use /O2 but smaller code for targets that use /Os. The installer size comparison suggests Clang's output compresses better.<br /><br />Some raw numbers for versions 64.0.3278.2 (MSVC PGO) and 64.0.3278.0 (Clang). mini_installer.exe is Chrome’s installer that users download, containing the LZMA-compressed code. chrome_child.dll is one of the two main dlls; it contains Blink and V8, and generally has many targets that are built with /O2. chrome.dll is the other main dll, containing the browser process code, mostly built with /Os.<br /><span id="docs-internal-guid-891146fc-f7de-b09a-1a30-b3298ec281f3"><br /></span><br /><div dir="ltr" style="margin-left: 0pt;"><table style="border-collapse: collapse; border: none;"><colgroup><col width="117"></col><col width="142"></col><col width="106"></col><col width="137"></col><col width="121"></col></colgroup><tbody><tr style="height: 0pt;"><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><br /></td><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">mini_installer.exe</span></div></td><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">chrome.dll</span></div></td><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">chrome_child.dll</span></div></td><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">chrome.exe</span></div></td></tr><tr style="height: 0pt;"><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">32-bit win-pgo</span></div></td><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">45.46 MB</span></div></td><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">36.47 MB</span></div></td><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">53.76 MB</span></div></td><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">1.38 MB</span></div></td></tr><tr style="height: 0pt;"><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">32-bit win-clang</span></div></td><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">45.65 MB</span></div><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">(+0.04%)</span></div></td><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">42.56 MB (+16.7%)</span></div></td><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">62.38 MB</span></div><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">(+16%)</span></div></td><td style="border-bottom: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">1.45 MB</span></div><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">(+5.1%)</span></div></td></tr><tr style="height: 0pt;"><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">64-bit win-pgo</span></div></td><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">49.4 MB</span></div></td><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">53.3 MB</span></div></td><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">65.6 MB</span></div></td><td style="border-top: solid #000000 0.5pt; padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">1.6 MB</span></div></td></tr><tr style="height: 0pt;"><td style="padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">64-bit win-clang</span></div></td><td style="padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">46.27 MB</span></div><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">(-6.33%)</span></div></td><td style="padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">50.6 MB</span></div><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">(-5.1%)</span></div></td><td style="padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">72.71 MB</span></div><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">(+10.8%)</span></div></td><td style="padding: 5pt 5pt 5pt 5pt; vertical-align: top;"><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">1.57 MB</span></div><div dir="ltr" style="line-height: 1.2; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">(-1.2%)</span></div></td></tr></tbody></table></div><h4 style="text-align: left;">Performance</h4>We conducted extensive A/B testing of performance. Performance telemetry numbers are about the same for MSVC-built and clang-built Chrome – some metrics get better, some get worse, but all of them are within 5% of each other. The official MSVC builds used LTCG and PGO, while the Clang builds currently use neither of these. This is potential for improvement that we look forward to exploring. The PGO builds took a very long time to build due to the need for collecting profiles and then building again, and as a result, the configuration was not enabled on our performance-measurement buildbots. Now that we use Clang, the perf bots again track the configuration that we ship.<br /><br />Startup performance was worse in Clang-built Chrome until we started using a <a href="https://chromium.googlesource.com/chromium/src/+/master/docs/win_order_files.md">link-order file</a> – a form of “PGO light” .<br /><h4 style="text-align: left;">Stability</h4>We A/B-tested stability as well and found no difference between the two build configurations.<br /><h3 style="text-align: left;">Motivation</h3>There were many motivating reasons for this project, the overarching theme being the benefits of using the same compiler across all of Chrome’s platforms, as well as the ability to change the compiler and deploy those changes to all our developers and buildbots quickly. Here’s a non-exhaustive list of examples.<br /><ul style="text-align: left;"><li>Chrome is heavily using technology that’s based on compiler instrumentation (ASan, CFI, <a href="https://blog.chromium.org/2012/04/fuzzing-for-security.html">ClusterFuzz</a>—uses ASan). Clang supports this instrumentation already, but we can’t add it to MSVC. We previously used <a href="https://github.com/google/syzygy">after-the-fact binary instrumentation</a> to mitigate this a bit, but having the toolchain write the right bits in the first place is cleaner and faster.</li><li>Clang enables us to write compiler <a href="https://www.chromium.org/developers/coding-style/chromium-style-checker-errors">plugins</a> that add Chromium-specific warnings and to write tooling for <a href="https://chromium.googlesource.com/chromium/src/+/lkcr/docs/clang_tool_refactoring.md">large-scale refactoring</a>. <a href="https://cs.chromium.org/">Chromium’s code search</a> can now learn to index Windows code.</li><li>Chromium is open-source, so it’s nice if it’s built with an open-source toolchain.</li><li>Chrome runs on 6+ platforms, and most developers are only familiar with 1-3 platforms. If your patch doesn’t compile on a platform you’re unfamiliar with, due to a compiler error that you can’t locally reproduce on your local development machine, it’ll take you a while to fix. On the other hand, if all platforms use the same compiler, if it builds on your machine then it’s probably going to build on all platforms.</li><li>Using the same compiler also means that compiler-specific micro-optimizations will help on all platforms (assuming that the same -O flags are used on all platforms – not yet the case in Chrome, and only on the same ISAs – x86 vs ARM will stay different).</li><li>Using the same compiler enables <a href="https://cs.chromium.org/chromium/src/docs/win_cross.md">cross-compiling</a> – developers who feel most at home on a Linux box can now work on Windows-specific code, from their Linux box (without needing to run Wine).</li><li>We can <a href="https://ci.chromium.org/p/chromium/g/chromium.clang/console">continuously build Chrome trunk with Clang trunk</a> to find compiler regressions quickly. This allows us to update Clang every week or two. Landing a major MSVC update in Chrome usually took a year or more, with several rounds of reporting internal compiler bugs and miscompiles. The issue here isn’t that MSVC is more buggy than Clang – it isn’t, all software is buggy – but that we can continuously improve Clang due to Clang being open-source.</li><li>C++ receives major new revisions every few years. When C++11 was released, we were still using six different compilers, and <a href="http://chromium-cpp.appspot.com/">enabling C++11</a> was difficult. With fewer compilers, this gets much easier.</li><li>We can prioritize compiler features that are important to us. For example:</li><ul><li><a href="https://www.chromium.org/developers/testing/isolated-testing/deterministic-builds">Deterministic builds</a> were important to us before they were important for the MSVC team. For example, link.exe /incremental depends on an incrementing mtime timestamp in each object file.</li><li>We could enable warnings that fired in system headers long before <a href="https://blogs.msdn.microsoft.com/vcblog/2017/12/13/broken-warnings-theory/">MSVC added support for the system header concept</a>.</li><li>cl.exe always prints the name of the input file, so that the <a href="https://github.com/ninja-build/ninja/blob/master/src/clparser.cc#L67">build system has to filter it out for quiet builds</a>.</li></ul></ul><br />Of course, not all – or even most – of these reasons will apply to other projects.<br /><h3 style="text-align: left;">Benefits and drawbacks of using Clang instead of Visual C++</h3><div style="text-align: left;">Benefits of using Clang, if you want to try for your project:</div><div style="text-align: left;"></div><ul style="text-align: left;"><li>Clang supports 64-bit inline assembly. For example, in Chrome we built libyuv (a video format conversion library) with Clang long before we built all of Chrome with it. libyuv had highly-tuned 64-bit inline assembly with performance not reachable with intrinsics, and we could just use that code on Windows.</li><li>If your project runs on multiple platforms, you can use one compiler everywhere. Building your project with several compilers is generally considered good for code health, but in Chrome we found that Clang’s diagnostics found most problems and we were mostly battling compiler bugs (and if another compiler has a great new diagnostic, we can add that to Clang).</li><li>Likewise, if your project is Windows-only, you can get a second compiler’s opinion on your code, and Clang’s warnings might find bugs.</li><li>You can use <a href="https://clang.llvm.org/docs/AddressSanitizer.html">Address Sanitizer</a> to find memory bugs.</li><li>If you don’t use LTCG and PGO, it’s possible that Clang might create faster code.</li><li>Clang’s <a href="https://clang.llvm.org/diagnostics.html">diagnostics and fix-it hints</a>.</li></ul>There are also drawbacks:<br /><ul style="text-align: left;"><li>Clang doesn’t support C++/CX or #import “foo.dll”.</li><li>MSVC offers paid support, Clang only gives you the code and the ability to write patches yourself (although the community is very active and helpful!).</li><li>MSVC has better documentation.</li><li>Advanced debugging features such as Edit &amp; Continue don’t work when using Clang.</li></ul><h3 style="text-align: left;">How to use</h3>If you want to give Clang for Windows a try, there are two approaches:<br /><ol style="text-align: left;"><li>You could use clang-cl, a compiler driver that tries to be command-line flag compatible with cl.exe (just like Clang tries to be command-line flag compatible with gcc). The <a href="https://clang.llvm.org/docs/UsersManual.html#clang-cl">Clang user manual</a> describes how you can tell popular Windows build systems how to call clang-cl instead of cl.exe. We used this approach in Chrome to keep the Clang/Win build working alongside the MSVC build for years, with minimal maintenance cost. You can keep using link.exe, all your current compile flags, the MSVC debugger or windbg, ETW, etc. clang-cl even writes warning messages in a format that’s compatible with cl.exe so that you can click on build error messages in Visual Studio to jump to the right file and line. Everything should just work.</li><li>Alternatively, if you have a cross-platform project and want to use gcc-style flags for your Windows build, you can pass a Windows triple (e.g. --target=x86_64-windows-msvc) to regular Clang, and it will produce MSVC-ABI-compatible output. Starting in Clang 7.0.0, due Fall 2018, Clang will also default to CodeView debug info with this triple.</li></ol>Since Clang’s output is ABI-compatible with MSVC, you can build parts of your project with clang and other parts with MSVC. You can also pass <a href="https://clang.llvm.org/docs/UsersManual.html#the-fallback-option">/fallback</a> to clang-cl to make it call cl.exe on files it can’t yet compile (this should be rare; it never happens in the Chrome build).<br /><br />clang-cl accepts Microsoft language extensions needed to parse system headers but tries to emit -Wmicrosoft-foo warnings when it does so (warnings are ignored for system headers). You can choose to fix your code, or pass -Wno-microsoft-foo to Clang.<br /><br />link.exe can produce regular PDB files from the CodeView information that Clang writes.<br /><h3 style="text-align: left;">Project History</h3>We switched chrome/mac and <a href="http://blog.llvm.org/2015/01/using-clang-for-chrome-production.html">chrome/linux</a> to Clang a while ago. But on Windows, Clang was still missing support for parsing many Microsoft language extensions, and it didn’t have any Microsoft C++ ABI-compatible codegen at all. In 2013, we <a href="http://blog.llvm.org/2013/09/a-path-forward-for-llvm-toolchain-on.html">spun up a team</a> to improve Clang’s Windows support, consisting half of Chrome engineers with a compiler background and half of other toolchain people. In mid-2014, Clang could <a href="http://blog.llvm.org/2014/07/clangllvm-on-windows-update.html">self-host on Windows</a>. In February 2015, we had the first fallback-free build of 64-bit Chrome, in July 2015 the first fallback-free build of 32-bit Chrome (32-bit SEH was difficult). In Oct 2015, we shipped a first clang-built Chrome to the Canary channel. Since then, we’ve worked on <a href="http://https//crbug.com/457078">improving the size of Clang’s output</a>, <a href="https://crbug.com/636111">improved Clang’s debug information</a> (some of it behind -instcombine-lower-dbg-declare=0 for now), and A/B-tested stability and telemetry performance metrics.<br /><br />We use versions of Clang that are pinned to a recent upstream revision that we update every one to three weeks, without any local patches. All our work is done in upstream LLVM.<br /><br />Mid-2015, Microsoft announced that they were building on top of our work of making Clang able to parse all the Microsoft SDK headers with <a href="https://blogs.msdn.microsoft.com/vcblog/2015/05/01/bringing-clang-to-windows/">clang/c2</a>, which used the Clang frontend for parsing code, but cl.exe’s codegen to generate code. <a href="https://twitter.com/stephantlavavej/status/871861920315211776?lang=en">Development on clang/c2 was halted again</a> in mid-2017; it is conceivable that this was related to our improvements to MSVC-ABI-compatible Clang codegen quality. We’re thankful to Microsoft for publishing documentation on the PDB file format, answering many of our questions, fixing Clang compatibility issues in their SDKs, and for giving us publicity on their blog! Again, Clang is not a replacement for MSVC, but a complement to it.<br /><br />Opera for Windows is also <a href="http://blogs.opera.com/desktop/2018/02/opera-51/">compiled with Clang</a> starting in version 51.<br /><br />Firefox is also looking at <a href="https://ehsanakhgari.org/blog/2016-01-29/building-firefox-with-clang-cl-a-status-update">using clang-cl for building Firefox for Windows</a>.<br /><h3 style="text-align: left;">Next Steps</h3>Just as clang-cl is a cl.exe-compatible interface for Clang, lld-link is a link.exe-compatible interface for lld, the LLVM linker. Our next step is to use lld-link as an alternative to link.exe for linking Chrome for Windows. This has many of the same advantages as clang-cl (open-source, easy to update, …). Also, using clang-cl together with lld-link allows using <a href="https://llvm.org/docs/LinkTimeOptimization.html">LLVM-bitcode-based LTO</a> (which in turn enables using <a href="https://clang.llvm.org/docs/ControlFlowIntegrity.html">CFI</a>) and <a href="http://blog.llvm.org/2018/01/improving-link-time-on-windows-with.html">using PE/COFF extensions to speed up linking</a>. A prerequisite for using lld-link was <a href="http://blog.llvm.org/2017/08/llvm-on-windows-now-supports-pdb-debug.html">its ability to write PDB files</a>.<br />We’re also considering using libc++ instead of the MSVC STL – this allows us to instrument the standard library, which is again useful for CFI and Address Sanitizer.<span style="white-space: pre;">   </span><br /><h3 style="text-align: left;">In Closing</h3>Thanks to the whole LLVM community for helping to create the first new production C++ compiler for Windows in over a decade, and the first-ever open-source C++ compiler that’s ABI-compatible with MSVC!<br /><div><br /></div></div>
