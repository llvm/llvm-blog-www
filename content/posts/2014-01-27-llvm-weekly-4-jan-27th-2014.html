---
author: Unknown
blogger_id: tag:blogger.com,1999:blog-6088150582281556517.post-1348706762873763148
blogger_orig_url: http://blog.llvm.org/2014/01/llvm-weekly-4-jan-27th-2014.html
url: "2014/01/llvm-weekly-4-jan-27th-2014.html" 
date: "2014-01-27T05:46:00Z"
modified_time: "2014-04-06T10:29:17.192-07:00"
tags: ["llvmweekly"]
title: 'LLVM Weekly - #4, Jan 27th 2014'
aliases:
 - /2014/01/llvm-weekly-4-jan-27th-2014.html
---

<p>Welcome to the fourth issue of LLVM Weekly, a weekly newsletter (published  every Monday) covering developments in LLVM, Clang, and related projects. This  marks the end of the first month of operation, here's to many more! LLVM  Weekly is brought to you by <a href="http://asbradbury.org">Alex Bradbury</a>. Subscribe to future issues at <a href="http://llvmweekly.org">http://llvmweekly.org</a> and pass it on to anyone  else you think may be interested. Please send any tips or feedback to  <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#115;&#98;&#64;&#97;&#115;&#98;&#114;&#97;&#100;&#98;&#117;&#114;&#121;&#46;&#111;&#114;&#103;">&#97;&#115;&#98;&#64;&#97;&#115;&#98;&#114;&#97;&#100;&#98;&#117;&#114;&#121;&#46;&#111;&#114;&#103;</a>, or <a href="https://twitter.com/llvmweekly">@llvmweekly</a> or <a href="https://twitter.com/asbradbury">@asbradbury</a> on Twitter. I've been keeping the <a href="https://twitter.com/llvmweekly">@llvmweekly Twitter account</a>  updated throughout the week, so follow that if you want more frequent news  updates.</p> <p>The canonical home for this issue <a href="http://llvmweekly.org/issue/4">can be found here at llvmweekly.org</a>. </p> <a name='more'></a> <h3>News and articles from around the web</h3><p>The biggest compiler-related news this week has been the discussions on the  GCC mailing list. Things kicked off with <a href="http://gcc.gnu.org/ml/gcc/2014-01/msg00176.html">Eric S. Raymond's  post</a> suggesting that  technical progress in GCC is being held back by concerns about reusing parts  of GCC in a way that bypasses the copyleft license. Ian Lance Taylor  <a href="http://gcc.gnu.org/ml/gcc/2014-01/msg00181.html">responded</a> to point out that  GCC now has a plugin system, albeit with an unstable interface, which mostly  put a stop to that line of discussion. However a <a href="http://gcc.gnu.org/ml/gcc/2014-01/msg00247.html">later post to the mailing  list from Richard Stallman</a>  has proved very controversial by claiming that "The existence of LLVM is a terrible setback for our community precisely because it is not copylefted and can be used as the basis for nonfree compilers". There's plenty  of discussion of these comments around the web <a href="http://lwn.net/Articles/582242/">at  LWN</a>, Hacker News, Reddit, Slashdot etc. Although many of us may have a preference for non-copyleft ('permissive') free  software licenses, RMS has consistently and over a long period of time argued  that copyleft licenses ultimately do a better job of spreading free software  and preserving its freedom. As such, it's not clear to me why this mailing  list post has come as a surprise to many. I'm personally surprised he didn't  bring up the fact that the BSD-style license used by LLVM contains no explicit  patent grant (though LLVM does have a <a href="http://llvm.org/docs/DeveloperPolicy.html#patents">patent  policy</a> to help protect its  users).</p><p>Rapidly moving away from controversial topics, an exciting milestone for the  LLVM project was hit this week. The <a href="http://reviews.llvm.org/rL200000">200000th commit</a>  has been applied. Takumi Nakamura was lucky enough to be the one to author  that commit.</p><p>The Khronos group has <a href="https://www.khronos.org/news/press/khronos-releases-spir-1.2-specification-for-portable-encoding-of-opencl-dev">released the SPIR 1.2  specification</a>. SPIR is a standardised intermediate representation meant for use with OpenCL,  and is based on LLVM 3.2 IR. With the release, the Khronos Group have open  sourced a modified Clang 3.2 which can generate SPIR from OpenCL C programs as  well as a module verifier.</p><p>Joaquín M López Muñoz has published a benchmark <a href="http://bannalia.blogspot.co.uk/2014/01/a-better-hash-table-clang.html">comparing hash table  performance on  Clang</a>. He compares GCC's libstdc++-v3 to the LLVM project's libc++.</p><p>The Cambridge (UK) LLVM socials <a href="http://article.gmane.org/gmane.comp.compilers.clang.devel/34548">are starting up  again</a>, with  the next one on the 29th Jan at 7.30pm. Sadly I can't make it, hopefully the  next one!</p><h3>On the mailing lists</h3><ul><li><p>Chandler Carruth asks <a href="http://article.gmane.org/gmane.comp.compilers.llvm.devel/69689">whether LoopPass and LoopPassManager can be  removed</a>. He  lists the confusion and issues they cause, most damning to me is that they  reoutinely modify IR from outside of the loop thus breaking the implied  contract of a 'loop pass'. The discussion ended up with the proposal that  LoopSimplify, LCSSA, and LoopVectorizer become function passes. As you can see  from the LLVM commit section below, Chandler quickly submitted patches to do  this which have been applied.</p></li><li><p>Vadim asks for input on his idea of <a href="http://article.gmane.org/gmane.comp.compilers.llvm.devel/69727">using LLVM to generate code with  position-independent  stacks</a>. This  would be usual for implementing something similar to Python greenlets. Mark  Seaborn points to <a href="https://codereview.chromium.org/29743003/">some similar  work</a> he has done which restricts  memory access to a range of address space.</p></li><li><p>Tom Stellard has completed a <a href="http://article.gmane.org/gmane.comp.compilers.llvm.devel/69778">suggested policy and process for LLVM minor  releases</a>.</p></li><li><p>Shea Levy, a maintainer for nixpkgs writes to the list with <a href="http://article.gmane.org/gmane.comp.compilers.llvm.devel/69662">the issues he  has  encountered</a>packaging LLVM and Clang for Nix.</p></li><li><p>Raul Silvera <a href="http://article.gmane.org/gmane.comp.compilers.llvm.devel/69781">asks for opinions on removing the ReadOnly attribute from math  intrinsics</a> on  the grounds that changes to the floating point environment (such as rounding  mode) aren't modelled anyway. As Raul points out in a later followup "We  currently appear to be at the worst of both worlds as we do not have support  for this environment but are always being constrained by it."</p></li><li><p>Sebastien Riou asks <a href="http://article.gmane.org/gmane.comp.compilers.llvm.devel/69670">how to force a MachineFunctionPass to be the last  one</a>. Peter  Cooper suggests that at the moment you can add the pass to the end of  <code>X86PassConfig::addPreEmitPass</code> or add the pass after the call to preEmitBass  and before the ASM printer is added.</p></li><li><p>Jasper Neumann has spotted various cases where <a href="http://thread.gmane.org/gmane.comp.compilers.llvm.devel/69601">LLVM leaves unnecessary  register moves</a>  in the generated code. Andrew Trick suggests copy-eliminating peepholes could  be added after register allocation, but that in general there is reluctance to  introduce extra complexity to optimise special cases involving multiple  physical register copies due to the small impact they have on performance.</p></li><li><p>David Chisnall enquires whether <a href="http://article.gmane.org/gmane.comp.compilers.llvm.devel/69711">LLVM relies on the assumption that the  stack is in address space  0</a>. Matt  Arsenault notes that OpenCL local variables currently work by created globals  rather than alloca'ing a nondefault address space. He suggests the limitation  stems from the fact a number of places in the compiler assume the address  space is 0 and never check by retrieving the address space of the relevant  pointer.</p></li><li><p>Christian Schafmeister has posted <a href="http://article.gmane.org/gmane.comp.compilers.clang.devel/34505">a preannouncement of his  soon-to-be-released C++ refactoring  tool</a>,  written in Lisp. It makes use of clang's ASTMatcher/Refactoring library. I'm  looking forward to the promised open source release.</p></li><li><p>David Fang has posted a <a href="http://article.gmane.org/gmane.comp.compilers.clang.devel/34507">summary of the status of libc++ on  powerpc-darwin</a>.</p></li></ul><h3>LLVM commits</h3><ul><li><p>LoopSimplify is no longer a LoopPass, instead it is both a utility function  and a FunctionPass. The motivation was to be able to compute function analysis  passes after running LoopSimplify, but the change has a bunch of other  advantages described in detail in the commit message. <a href="http://reviews.llvm.org/rL199884">r199884</a>. Additionally, the LCSSA  (loop-closed SSA) pass was made a utility with a function pass and the  LoopVectorizer became a FunctionPass. <a href="http://reviews.llvm.org/rL200067">r200067</a>,  <a href="http://reviews.llvm.org/rL200074">r200074</a>.</p></li><li><p>The Constant Hoisting Pass was born. <a href="http://reviews.llvm.org/rL200022">r200022</a>.</p></li><li><p>InstCombine learned how to deal with vectors for most  fmul/fvid/add/sub/mul/div combines. <a href="http://reviews.llvm.org/rL199598">r199598</a>,  <a href="http://reviews.llvm.org/rL199602">r199602</a>.</p></li><li><p>Type-based alias analysis has, for the time being, been disabled when using  alias analysis in CodeGen due to two shortcomings described in the commit  message. <a href="http://reviews.llvm.org/rL200093">r200093</a>.</p></li><li><p>LTO gained new methods which allows the user to parse metadata nodes,  extract linker options, and extract dependent libraries from a bitcode module. <a href="http://reviews.llvm.org/rL199759">r199759</a>.</p></li><li><p>The Sparc backend now supports the inline assembly constraint 'I'. <a href="http://reviews.llvm.org/rL199781">r199781</a>.</p></li><li><p>The x86 backend allows segment and address-size overrides for  movs/lods/outs, fixing <a href="http://llvm.org/bugs/show_bug.cgi?id=9385">bug 9385</a>. <a href="http://reviews.llvm.org/rL199803">r199803</a> and more.</p></li><li><p>llvm-ar no longer opens or fstats file twice. <a href="http://reviews.llvm.org/rL199815">r199815</a>.</p></li><li><p>When compiling a function with the minsize attribute, the ARM backend will  now use literal pools even for normal i32 immediates. <a href="http://reviews.llvm.org/rL199891">r199891</a>.</p></li><li><p>There was a fair bit of activity on the R600 backend. I haven't had the time  to properly summarise that activity or pick out the most important commits, so  I recommend those interested take a look through the commit logs.</p></li><li><p>JIT is now supported for Sparc64. <a href="http://reviews.llvm.org/rL199977">r199977</a>.</p></li><li><p>llvm-readobj gained support for the PE32+ format (used for Windows 64-bit  executables). <a href="http://reviews.llvm.org/rL200117">r200117</a>.</p></li></ul><h3>Clang commits</h3><ul><li><p>Registry::getCompletions was implemented. This returns a list of valid completions for a given context. <a href="http://reviews.llvm.org/rL199950">r199950</a>.</p></li><li><p>Clang gained basic support for the attribute <code>returns_nonnull</code>. <a href="http://reviews.llvm.org/rL199626">r199626</a>,  <a href="http://reviews.llvm.org/rL199790">r199790</a>.</p></li><li><p>getResultType on function and method declarations was renamed to  getReturnType which is a semantically more accurate name. <a href="http://reviews.llvm.org/rL200082">r200082</a>. Similarly, getResultLoc  was renamed to getReturnLoc. <a href="http://reviews.llvm.org/rL200105">r200105</a>.</p></li><li><p>All applicable accessors in FunctionProtoType have been renamed from  <code>*argument*</code> to <code>*parameter*</code>. <a href="http://reviews.llvm.org/rL199686">r199686</a>.</p></li><li><p>Clang was taught to look in its installation libdir for libraries such as  libc++ when the installation is within the system root. <a href="http://reviews.llvm.org/rL199769">r199769</a>.</p></li><li><p>A module.map file is now required to load a module. <a href="http://reviews.llvm.org/rL199852">r199852</a>.</p></li></ul><h3>Other project commits</h3><ul><li><p>lldb learned the 'step-avoid-libraries' setting, which allows a user to list  libraries to avoid. <a href="http://reviews.llvm.org/rL199943">r199943</a>.</p></li><li><p>In compiler-rt, support was added for intercepting and sanitizing arguments  passed to printf functions in AddressSanitizer and ThreadSanitizer. <a href="http://reviews.llvm.org/rL1999729">r199729</a>.</p></li><li><p>A fix was committed to ThreadSanitizer to prevent deadlocking after a fork. <a href="http://reviews.llvm.org/rL1999993">r199993</a>.</p></li><li><p>Dragonegg can now be built with CMake. <a href="http://reviews.llvm.org/rL199994">r199994</a>.</p></li><li><p>Compiler-rt gained support in its udiv/umod implementations for ARMv4 which  lacks bx and clz. Code changes also resulting in a 30%+ performance  improvement on the Raspberry Pi (armv7, ARM1176) and 5-10% on a Cortex A9. <a href="http://reviews.llvm.org/rL200001">r200001</a>.</p></li><li><p>In AddressSanitizer on Android, all AddressSanitizer output is duplicated to  the system log. <a href="http://reviews.llvm.org/rL1999887">r199887</a>.</p></li><li><p>lld gained support for emitting a PE32+ file header. <a href="http://reviews.llvm.org/rL200128">r200128</a>.</p></li><li><p>lldb now supports Haswell on x86-64. <a href="http://reviews.llvm.org/rL199854">r199854</a>.</p></li></ul>
