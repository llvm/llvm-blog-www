---
author: Daniel Dunbar
blogger_id: tag:blogger.com,1999:blog-6088150582281556517.post-6162752575709548929
blogger_orig_url: http://blog.llvm.org/2009/12/lit-it.html
date: "2009-12-17T20:11:00Z"
modified_time: "2009-12-17T23:29:32.942-08:00"
tags: ["testing"]
title: '''lit'' it'
url: "2009/12/lit-it.html"
---

<div>If you've been watching LLVM and Clang, you'll notice that there is a new testing tool we are using called <b>lit</b>. Clang has already moved to it, and LLVM has support for it (DejaGNU is still the default, but is being phased out). I thought I'd write a little bit about why I wrote <b>lit</b>, what it is, and how it will make your life better. :)<br /></div><div><br /><a name='more'></a><br /><br /></div><div>First, let me summarize the pre-<b>lit</b> background:<br /></div><div><ul><li>LLVM used <a href="http://www.gnu.org/software/dejagnu/">DejaGNU</a> and <a href="http://code.google.com/p/googletest/">googletest</a> unit tests. Our usage of DejaGNU was pretty limited though, what we really used was a test format which embedded shell scripts inside each test file. Our DejaGNU harness would interpret those commands, substitute a few variables, run them, and check the exit status. The googletest unit tests were run separately, and frequently forgotten.</li><li>Clang used a similar looking -- but completely different -- infrastructure which still had embedded shell scripts, but ran them via <b>make</b> and <b>sed</b>.  It had the notable advantage of running tests in parallel and being significantly simpler, but not particularly flexible.</li></ul><div>One thing both systems had in common was that it was very easy to add a new test, usually a couple lines in a file in the appropriate directory. But there were some annoying cons:<br /></div><div><ul><li>There was no way to run tests via CMake or on Windows.</li><li>LLVM tests weren't run in parallel.</li><li>The UI to the tests was inconsistent and cumbersome (especially for DejaGNU, which would required invoking the LLVM Makefile via a shell script, which then invoked DejaGNU's runtest command).</li></ul><div>I didn't actually set out to write a new testing tool -- <b>lit </b>started because I had a need to run a very large number of "tests", which was just a fixed script to run with many different inputs. I hacked up a quick multithreaded Python test runner for it, and over time it grew a progress bar and more features. Later, when there was growing interest in having Clang work on Windows I wrote a Python based interpreter for the scripts (remember, they amounted to just shell scripts, so <b>lit</b> has what amounts to a little (ba)<b>sh</b> lexer and parser hiding in it). It didn't take a lot of imagination to put the two together and feature creep it until it could replace DejaGNU (yeah, it has a tiny Tcl parser too).<br /></div><div><br /></div><div>So, what <i>is </i><b>lit</b>? Strictly speaking, <b>lit</b> is a test running infrastructure, like DejaGNU. Its primary job is to find tests, execute them, and report the results to the user; it just happens to have built in support for the LLVM and Clang test formats. My number one design goal was that <b>lit</b> should "just work" whenever possible -- running a test should be as easy as<br /></div><pre><b>$ lit exprs.s</b><br />lit: lit.cfg:94: note: using out-of-tree build at '/Volumes/Data/ddunbar/llvm.obj.64'<br />-- Testing: 1 tests, 2 threads --<br />PASS: LLVM::MC/AsmParser/exprs.s (1 of 1)<br />Testing Time: 0.06s<br />Expected Passes    : 1<br /></pre><div>no matter if you are using an in-tree or out-of-tree build, testing Clang or LLVM, a regression test or googletest based unit test, on Windows or Unix, and so on. And of course I also wanted it to be fast!<br /></div><div><br /></div><div>I'm not going to go into more detail on how to use <b>lit</b> (since it should be self explanatory or documented) but these are some of the features and benefits we've gotten from switching to <b>lit</b>:<br /></div><div><ul><li>LLVM tests run much faster, this improved our buildbot build/test cycle on a fast machine by about 25%, if I recall correctly. I still have a secret desire to make them even faster... one day...</li><li>Clang tests work on Windows and have been incorporated into our buildbot. There is still work to be done on LLVM tests.</li><li>LLVM/Clang tests work in CMake builds (with Makefiles, Xcode, and Visual Studio generators).</li><li><b>lit</b> integrates nicely into buildbot, so individual failures get split out into their own log. I hope to continue to improve the UI for diagnosing failures.</li><li>The LLVM googletest based unit tests are seamlessly integrated with the other tests. In fact, when using the standard LLVM Makefiles, its possibly to run all LLVM &amp; Clang tests with just <tt>make check-all</tt>.</li><li>We're using some of the fancier <b>lit</b> features to help with C++ testing. For example, we have custom test suites which run <tt>clang -fsyntax-only</tt> over libstdc++ and the LLVM/Clang headers to test the parser, or which run <tt>clang -c</tt> over the LLVM and Clang C++ code to test Clang's C++ code generation. I secretly suspect Doug of having more <b>lit </b>test suites hiding on his hard drive.</li><li>And I have more improvements in store...</li></ul></div><div>You can read the <b>lit</b> man page <a href="http://llvm.org/cmds/lit.html">here</a>, and I hope to add more information to the LLVM <a href="http://llvm.org/docs/TestingGuide.html">Testing Guide</a> once all the pieces are fully in place. Try it out, I hope you like it!<br /></div><div><br /></div><div>- Daniel<br /></div><div><br /></div><div>p.s. <b>lit</b> stands for LLVM Integrated Tester, at least thats what I publicly claim. That, or it's the first three letter pronounceable name I came up with...<br /></div></div></div>
