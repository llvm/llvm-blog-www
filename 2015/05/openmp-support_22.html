<!doctype html><html lang=en><head><title>OpenMP Support - The LLVM Project Blog</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="LLVM Project News and Details from the Trenches"><meta name=author content="Alexey Bataev"><meta property="og:url" content="https://blog.llvm.org/2015/05/openmp-support_22.html"><meta property="og:site_name" content="The LLVM Project Blog"><meta property="og:title" content="OpenMP Support"><meta property="og:description" content="OpenMP support in Clang compiler is completed! Every pragma and clause from 3.1 version of the standard is supported in full, including combined directives (like ‘#pragma omp parallel for’ and ‘#pragma omp parallel sections’)."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-05-22T08:23:00+00:00"><meta property="article:modified_time" content="2015-05-22T08:23:00+00:00"><meta property="article:tag" content="OpenMP"><meta property="article:tag" content="Clang"><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenMP Support"><meta name=twitter:description content="OpenMP support in Clang compiler is completed! Every pragma and clause from 3.1 version of the standard is supported in full, including combined directives (like ‘#pragma omp parallel for’ and ‘#pragma omp parallel sections’)."><meta name=generator content="Hugo 0.128.0"><link rel=stylesheet href=https://blog.llvm.org/css/normalize.min.css><link rel=stylesheet href=https://blog.llvm.org/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=https://blog.llvm.org/css/styles.css></head><body><div id=container><header><h1><a href=https://blog.llvm.org/>The LLVM Project Blog</a></h1><ul id=social-media><li><a href=https://www.facebook.com/llvmorg title=Facebook><i class="fab fa-facebook fa-lg"></i></a></li><li><a href=https://github.com/llvm title=GitHub><i class="fab fa-github fa-lg"></i></a></li><li><a href=https://twitter.com/llvmorg title=Twitter><i class="fab fa-twitter fa-lg"></i></a></li><li><a href=https://www.youtube.com/c/LLVMPROJ title=Youtube><i class="fab fa-youtube fa-lg"></i></a></li></ul><p><em>LLVM Project News and Details from the Trenches</em></p></header><nav><ul><li><a href=https://blog.llvm.org/about><i class="fa-li fa fa-lg"></i><span>About</span></a></li><li><a href=https://blog.llvm.org/posts><i class="fa-li fa fa-lg"></i><span>Posts</span></a></li><li><a href=https://blog.llvm.org/tags><i class="fa-li fa fa-lg"></i><span>Tags</span></a></li><li><a href=https://llvm.org/><i class="fa-li fa fa-lg"></i><span>llvm.org</span></a></li></ul></nav><main><article><h1>OpenMP Support</h1><aside><ul><li>By Alexey Bataev</li><li><time class=post-date datetime=2015-05-22T08:23:00Z>May 22, 2015</time></li><li><em><a href=https://blog.llvm.org/tags/openmp>#OpenMP</a>
,
<a href=https://blog.llvm.org/tags/clang>#Clang</a></em></li><li>2 minute read</li></ul></aside><div dir=ltr style=text-align:left trbidi=on><div class=MsoNormal><span lang=EN-US>OpenMP support in Clang compiler is completed! Every pragma and clause from <a href=http://www.openmp.org/mp-documents/OpenMP3.1.pdf>3.1 version of the standard</a>&nbsp;is supported in full, including combined directives (like ‘#pragma omp parallel for’ and ‘#pragma omp parallel sections’). &nbsp;In addition</span>, some elements of OpenMP 4.0 are supported as well. This includes “almost complete” support for ‘#pragma omp simd” and full support for ‘#pragma omp atomic’ &nbsp;(combined pragmas and a couple of clauses are still missing).</div><div class=MsoNormal><span lang=EN-US><br></span></div><div class=MsoNormal><span lang=EN-US>OpenMP enables Clang users to harness full power of modern multi-core processors with vector units. Pragmas from OpenMP 3.1 provide an industry standard way to employ task parallelism, while ‘#pragma omp simd’ is a simple yet flexible way to enable data parallelism (aka vectorization).</span><br><span lang=EN-US><br></span></div><div class=MsoNormal><span lang=EN-US>Clang implementation of OpenMP standard relies on LLVM OpenMP runtime library, available at <a href=http://openmp.llvm.org/>http://openmp.llvm.org/</a>. This runtime supports ARM® architecture processors, PowerPC™ processors, 32 and 64 bit X86 processors and provides ABI compatibility with GCC and Intel's existing OpenMP compilers.</span><br><span lang=EN-US><br></span></div><div class=MsoNormal><span lang=EN-US>To enable OpenMP, just add ‘<tt>-fopenmp</tt>’ to the command line and provide paths to OpenMP headers and library with ‘<tt>-I &lt;</tt><i>path to omp.h</i><tt>> -L &lt;</tt><i>LLVM OpenMP library path</i><tt>></tt>’.</span><br><span lang=EN-US><br></span></div><div class=MsoNormal><span lang=EN-US>To run a compiled program you may need to provide a path to shared OpenMP library as well:<o:p></o:p></span></div><div class=MsoNormal><br></div><div class=MsoNormal><tt>$ export LD_LIBRARY_PATH=&lt;OpenMP library path>:$LD_LIBRARY_PATH</tt></div>or:<br><div class=MsoNormal><tt>$ export DYLD_LIBRARY_PATH=&lt;OpenMP library path>:$DYLD_LIBRARY_PATH</tt></div>on Mac OS X.<br><br><div class=MsoNormal><span lang=EN-US>You can confirm that the compiler works correctly by trying this simple parallel C program:<o:p></o:p></span></div><div class=MsoNormal><br></div><div class=MsoNormal><span lang=EN-US style="font-family:trebuchet ms,sans-serif">#include &lt;omp.h><o:p></o:p></span></div><div class=MsoNormal><span lang=EN-US style="font-family:trebuchet ms,sans-serif">#include &lt;stdio.h><o:p></o:p></span></div><div class=MsoNormal><span lang=EN-US style="font-family:trebuchet ms,sans-serif">int main() {<o:p></o:p></span></div><div class=MsoNormal><span lang=EN-US style="font-family:trebuchet ms,sans-serif">#pragma omp parallel<o:p></o:p></span></div><div class=MsoNormal><span lang=EN-US style="font-family:trebuchet ms,sans-serif">&nbsp;&nbsp;&nbsp; printf("Hello from thread %d, nthreads %d\n", omp_get_thread_num(), omp_get_num_threads());<o:p></o:p></span></div><div class=MsoNormal><span lang=EN-US><span style="font-family:trebuchet ms,sans-serif">}</span><o:p></o:p></span></div><div class=MsoNormal><br></div><div class=MsoNormal><span lang=EN-US>Compile it (you should see no errors or warnings):<o:p></o:p></span></div><div class=MsoNormal><br></div><div class=MsoNormal><span lang=EN-US style="font-family:courier new;font-size:10pt"><span style="font-family:trebuchet ms,sans-serif">$ clang -fopenmp -I &lt;path to omp.h> -L &lt;LLVM OpenMP library path> hello_openmp.c -o hello_openmp</span><o:p></o:p></span></div><div class=MsoNormal><br></div><div class=MsoNormal><span lang=EN-US>and execute: <o:p></o:p></span></div><div class=MsoNormal><br></div><div class=MsoNormal><span lang=EN-US style="font-family:trebuchet ms,sans-serif;font-size:10pt">$ <span style=background:#fff;color:#222>export [DY]LD_LIBRARY_PATH=&lt;OpenMP library path>:$[DY]LD_LIBRARY_PATH</span><o:p></o:p></span></div><div class=MsoNormal><span lang=EN-US style="font-family:courier new;font-size:10pt"><span style="font-family:trebuchet ms,sans-serif">$ ./hello_openmp</span><o:p></o:p></span></div><div class=MsoNormal><br></div><div class=MsoNormal><span lang=EN-US>You will see more than one “Hello” line with different thread numbers (note that the lines may be mixed together). If you see only one line, try setting the environment variable OMP_NUM_THREADS to some number (say 4) and try again.</span><br><span lang=EN-US><br></span></div><div class=MsoNormal><span lang=EN-US>Hopefully, you will enjoy using OpenMP and witness dramatic boosts of your applications’ performance!<o:p></o:p></span></div></div></article><section class=post-nav><ul><li><a href=https://blog.llvm.org/2015/05/llvm-weekly-72-may-18th-2015.html><i class="fa fa-chevron-circle-left"></i> LLVM Weekly - #72, May 18th 2015</a></li><li><a href=https://blog.llvm.org/2015/05/llvm-weekly-73-may-25th-2015.html>LLVM Weekly - #73, May 25th 2015 <i class="fa fa-chevron-circle-right"></i></a></li></ul></section></main><footer><ul><li><h6>llvm.org |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://blog.llvm.org/index.xml>Subscribe</a></h6></li></ul></footer></div><script src=https://blog.llvm.org/js/scripts.js></script></body></html>