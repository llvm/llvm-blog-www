<!doctype html><html lang=en><head><title>The LLVM Project Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="LLVM Project News and Details from the Trenches"><meta name=author content="Yuka Takahashi"><meta property="og:title" content="Clang ♥ bash -- better auto completion is coming to bash"><meta property="og:description" content="Compilers are complex pieces of software and have a multitude of command-line options to fine tune parameters. Clang is no exception: it has 447 command-line options. It’s nearly impossible to memorize all these options and their correct spellings, that's where shell completion can be very handy."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.llvm.org/2017/09/clang-bash-better-auto-completion-is.html"><meta property="article:published_time" content="2017-09-19T23:37:00+00:00"><meta property="article:modified_time" content="2017-09-19T23:37:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Clang ♥ bash -- better auto completion is coming to bash"><meta name=twitter:description content="Compilers are complex pieces of software and have a multitude of command-line options to fine tune parameters. Clang is no exception: it has 447 command-line options. It’s nearly impossible to memorize all these options and their correct spellings, that's where shell completion can be very handy."><meta name=generator content="Hugo 0.68.3"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://blog.llvm.org/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=https://blog.llvm.org/css/styles.css></head><body><div id=container><header><h1><a href=https://blog.llvm.org/>The LLVM Project Blog</a></h1><ul id=social-media><li><a href=https://www.facebook.com/llvmorg title=Facebook><i class="fab fa-facebook fa-lg"></i></a></li><li><a href=https://github.com/llvm title=GitHub><i class="fab fa-github fa-lg"></i></a></li><li><a href=https://twitter.com/llvmorg title=Twitter><i class="fab fa-twitter fa-lg"></i></a></li><li><a href=https://www.youtube.com/c/LLVMPROJ title=Youtube><i class="fab fa-youtube fa-lg"></i></a></li></ul><p><em>LLVM Project News and Details from the Trenches</em></p></header><nav><ul><li><a href=https://blog.llvm.org/about><i class="fa-li fa fa-lg"></i><span>About</span></a></li><li><a href=https://blog.llvm.org/posts><i class="fa-li fa fa-lg"></i><span>Posts</span></a></li><li><a href=https://blog.llvm.org/tags><i class="fa-li fa fa-lg"></i><span>Tags</span></a></li><li><a href=https://llvm.org/><i class="fa-li fa fa-lg"></i><span>llvm.org</span></a></li></ul></nav><main><article><h1>Clang ♥ bash -- better auto completion is coming to bash</h1><aside><ul><li><time class=post-date datetime=2017-09-19T23:37:00Z>Sep 19, 2017</time></li><li>Yuka Takahashi</li><li><em><a href=https://blog.llvm.org/tags/gsoc>#GSoC</a>
,
<a href=https://blog.llvm.org/tags/clang>#Clang</a></em></li><li>3 minutes read</li></ul></aside><div class=separator style=clear:both;text-align:center><a href=https://4.bp.blogspot.com/-01JogPSFCBM/WcKRj79NXNI/AAAAAAAANZA/X1Mr4wf_cnI57LGLoglYPn_XZWE_q-6egCLcBGAs/s1600/out.gif imageanchor=1 style=margin-left:1em;margin-right:1em><img border=0 data-original-height=500 data-original-width=800 height=400 src=https://4.bp.blogspot.com/-01JogPSFCBM/WcKRj79NXNI/AAAAAAAANZA/X1Mr4wf_cnI57LGLoglYPn_XZWE_q-6egCLcBGAs/s640/out.gif width=640></a></div><div class=separator style=clear:both;text-align:center></div><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a></span><br><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap></span></span></div><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a></span><br><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>Compilers are complex pieces of software and have a multitude of command-line options to fine tune parameters. Clang is no exception: it has 447 command-line options. It’s nearly impossible to memorize all these options and their correct spellings, that's where shell completion can be very handy. When you type in the first few characters of a flag and hit tab, it will autocomplete the rest for you.</span></span></div><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a></span><br><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a><span style=font-family:arial;font-size:14pt;font-weight:700;vertical-align:baseline;white-space:pre-wrap>Background</span><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break></span><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>However, such a autocompletion feature is not available yet, as there's no easy way to get a complete list of the options Clang supports. For example, bash doesn’t have any autocompletion support for Clang, and despite some shells like zsh having a script for command-line autocompletion, they use hard coded lists of command-line options, and are not automatically updated when a new option is added to Clang. These shells also can’t autocomplete arguments which some flags take (-std=[tab] for instance).</span></span><br><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap><br></span></div><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>This is the problem we were working to solve during this year’s Google Summer of Code. We’re adding a feature to Clang so that we can implement a complete, exact command-line option completion which is highly portable for any shell. To start with, we'll provide a completion script for bash which uses this feature.</span></span></div><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a></span><br><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a><span style=font-family:arial;font-size:14pt;font-weight:700;vertical-align:baseline;white-space:pre-wrap>Implementation</span></span></div><span id=docs-internal-guid-68af261c-84f5-10c3-00b1-6106d33aa46a><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>Clang now has a new command line option called </span><span style="font-family:courier new;font-size:11pt;vertical-align:baseline;white-space:pre-wrap">--autocomplete</span><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>. This flag receives the incomplete user input from the shell and then queries the internal data structures of the current Clang binary, and returns a list of possible completions. With this API, we can always get an accurate list of options and values any time, on any newer versions of Clang.</span></div><br><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>We built an autocompletion using this in bash for the first implementation. You can find its source code </span><a href=https://github.com/llvm-mirror/clang/blob/master/utils/bash-autocomplete.sh style=text-decoration-line:none><span style=color:#15c;font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>here</span></a><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>. Also, </span><a href=https://github.com/Teemperor/clang-autocomplete-qt-demo/blob/master/clangcompleter.cpp#L29 style=text-decoration-line:none><span style=color:#15c;font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>here</span></a><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap> is the sample for Qt text entry autocompletion to give an example how to use this API from an UI application as seen below:</span></div><br><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span style=font-family:arial;font-size:11pt;font-weight:700;vertical-align:baseline;white-space:pre-wrap><img alt=final.gif height=305 src=https://lh6.googleusercontent.com/ZMCiIg-nvoKUCVI3yrIxajonOBqEL1QiievBUEFeL3zNp-E6Ua6na5u6cenXMteX4XjqH2t_ve584cTA4Hw6MNczz6UtTOr_MpnejkI61fEhbsuhmIkccA7cUgmyIvyR4dni98dX style=-webkit-transform:rotate(0.00rad);border:none;transform:rotate(0.00rad) width=602></span></div><br><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>You can always complete one flag at a time. So if you want to use the API, you have to select the flag that the user is currently typing. Then just pass this flag to the --autocomplete flag in the selected clang binary. So in the case below all flags start with `-tr` are displayed with their descriptions behind them (separated from the flag with a tab character).</span><br><div class=separator style=clear:both;text-align:center><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap><a href=https://2.bp.blogspot.com/-VRKNRM79brs/WcKM_j0JZdI/AAAAAAAANYg/0JosgCr4lo0VphdvQMqGSTXBwtqzGIOqwCLcBGAs/s1600/tr.png imageanchor=1 style=margin-left:1em;margin-right:1em><img border=0 data-original-height=64 data-original-width=496 height=82 src=https://2.bp.blogspot.com/-VRKNRM79brs/WcKM_j0JZdI/AAAAAAAANYg/0JosgCr4lo0VphdvQMqGSTXBwtqzGIOqwCLcBGAs/s640/tr.png width=640></a></span></div></div><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap></span></div><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>The API also supports completing the values of flags. If you have a flag for which value completion is supported, you can also provide an incomplete value behind the flag separated by a comma to get completion for this:</span><br><div class=separator style=clear:both;text-align:center><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap><a href=https://2.bp.blogspot.com/-bu1RSxe2PjQ/WcKNLOcnCqI/AAAAAAAANYk/xu41ZdQbPKcIoR1VpjLcI_055YCWv_lsgCLcBGAs/s1600/stdlib.png imageanchor=1 style=margin-left:1em;margin-right:1em><img border=0 data-original-height=59 data-original-width=495 height=76 src=https://2.bp.blogspot.com/-bu1RSxe2PjQ/WcKNLOcnCqI/AAAAAAAANYk/xu41ZdQbPKcIoR1VpjLcI_055YCWv_lsgCLcBGAs/s640/stdlib.png width=640></a></span></div></div><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap></span></div><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>If you provide nothing after the comma, the list of the all possible values for this flag is displayed.</span></div><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><div class=separator style=clear:both;text-align:center><a href=https://4.bp.blogspot.com/-7CZRQ3DJUMA/WcKNQ_GeYgI/AAAAAAAANYo/YsnMXn5EcUIjPrO-y5nEVj6GvuEaRZ9jACLcBGAs/s1600/meabi.png imageanchor=1 style=margin-left:1em;margin-right:1em><img border=0 data-original-height=94 data-original-width=491 height=122 src=https://4.bp.blogspot.com/-7CZRQ3DJUMA/WcKNQ_GeYgI/AAAAAAAANYo/YsnMXn5EcUIjPrO-y5nEVj6GvuEaRZ9jACLcBGAs/s640/meabi.png width=640></a></div><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap></span></div><br><div dir=ltr style=line-height:1.38;margin-bottom:0;margin-top:0><span style=font-family:arial;font-size:14pt;font-weight:700;vertical-align:baseline;white-space:pre-wrap>How to get it</span></div><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>This feature is available for use now with LLVM/clang 5.0 and we’ll also be adding this feature to the standard bash completion package. Make sure you have the latest clang version on your machine, and source </span><a href=https://github.com/llvm-mirror/clang/blob/master/utils/bash-autocomplete.sh style=text-decoration-line:none><span style=color:#15c;font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>this script</span></a><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap>. If want to make the change permanent, just source it from your </span><span style="font-family:courier new;font-size:11pt;vertical-align:baseline;white-space:pre-wrap">.bashrc</span><span style=font-family:arial;font-size:11pt;vertical-align:baseline;white-space:pre-wrap> and enjoy typing your clang invocations!</span></span></article><section class=post-nav><ul><li><a href=https://blog.llvm.org/2017/09/2017-us-llvm-developers-meeting-program.html><i class="fa fa-chevron-circle-left"></i>2017 US LLVM Developers' Meeting Program</a></li><li><a href=https://blog.llvm.org/2018/01/improving-link-time-on-windows-with.html>Improving Link Time on Windows with clang-cl and lld <i class="fa fa-chevron-circle-right"></i></a></li></ul></section></main><footer><h6>llvm.org |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://blog.llvm.org/index.xml>Subscribe</a></h6></footer></div><script src=https://blog.llvm.org/js/scripts.js></script></body></html>