<!doctype html><html lang=en><head><title>What's wrong with this code? - The LLVM Project Blog</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="LLVM Project News and Details from the Trenches"><meta name=author content="Daniel Dunbar"><meta property="og:url" content="https://blog.llvm.org/2010/04/whats-wrong-with-this-code.html"><meta property="og:site_name" content="The LLVM Project Blog"><meta property="og:title" content="What's wrong with this code?"><meta property="og:description" content="A user on IRC sent me this interesting KLEE example today, which I thought was cute enough I should post it.
If you aren't familiar with it, KLEE is a tool for symbolic execution of LLVM code."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-04-07T11:49:00+00:00"><meta property="article:modified_time" content="2010-04-07T11:49:00+00:00"><meta property="article:tag" content="KLEE"><meta name=twitter:card content="summary"><meta name=twitter:title content="What's wrong with this code?"><meta name=twitter:description content="A user on IRC sent me this interesting KLEE example today, which I thought was cute enough I should post it.
If you aren't familiar with it, KLEE is a tool for symbolic execution of LLVM code."><meta name=generator content="Hugo 0.128.0"><link rel=stylesheet href=https://blog.llvm.org/css/normalize.min.css><link rel=stylesheet href=https://blog.llvm.org/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=https://blog.llvm.org/css/styles.css></head><body><div id=container><header><h1><a href=https://blog.llvm.org/>The LLVM Project Blog</a></h1><ul id=social-media><li><a href=https://www.facebook.com/llvmorg title=Facebook><i class="fab fa-facebook fa-lg"></i></a></li><li><a href=https://github.com/llvm title=GitHub><i class="fab fa-github fa-lg"></i></a></li><li><a href=https://twitter.com/llvmorg title=Twitter><i class="fab fa-twitter fa-lg"></i></a></li><li><a href=https://www.youtube.com/c/LLVMPROJ title=Youtube><i class="fab fa-youtube fa-lg"></i></a></li></ul><p><em>LLVM Project News and Details from the Trenches</em></p></header><nav><ul><li><a href=https://blog.llvm.org/about><i class="fa-li fa fa-lg"></i><span>About</span></a></li><li><a href=https://blog.llvm.org/posts><i class="fa-li fa fa-lg"></i><span>Posts</span></a></li><li><a href=https://blog.llvm.org/tags><i class="fa-li fa fa-lg"></i><span>Tags</span></a></li><li><a href=https://llvm.org/><i class="fa-li fa fa-lg"></i><span>llvm.org</span></a></li></ul></nav><main><article><h1>What's wrong with this code?</h1><aside><ul><li>By Daniel Dunbar</li><li><time class=post-date datetime=2010-04-07T11:49:00Z>Apr 7, 2010</time></li><li><em><a href=https://blog.llvm.org/tags/klee>#KLEE</a></em></li><li>2 minute read</li></ul></aside>A user on IRC sent me this interesting KLEE example today, which I thought was cute enough I should post it.<br><br><div>If you aren't familiar with it, <a href=http://klee.llvm.org/>KLEE</a> is a tool for symbolic execution of LLVM code. It is way too complicated to explain here, but for the purposes of this example all you need to know is that it tries to explore all possible paths through a program.</div><div><br><br><a name=more></a><br><br><br></div><div>In this case, the user was actually talking to me because he thought there was a bug in KLEE, because it was only finding one path through the code. Here is the example:</div><div><pre>$ cat t.c<br>#include "klee/klee.h"<br><br>int f0(int x) {<br>if (x * x == 1000)<br>return 1;<br>else<br>return 0;<br>}<br><br>int main() {<br>return f0(klee_int("x"));<br>}<br></pre>The idea here is that <tt>klee_int("x")</tt> creates a new symbolic variable, which can be <i>anything</i> (well, any possible <tt>int</tt>).</div><div><br></div><div>The user was expecting that there would be two possible paths through this program, one returning 1 and one returning 0. But KLEE only finds one:</div><div><pre>$ clang -I ~/public/klee/include -flto -c t.c<br>$ ~/public/klee.obj.64/Debug/bin/klee t.o<br>KLEE: output directory = "klee-out-5"<br><br>KLEE: done: total instructions = 24<br>KLEE: done: completed paths = 1<br>KLEE: done: generated tests = 1</pre><br></div><div>Upon showing the example to me, I was also confused for a moment. However, since I happen to trust KLEE, I knew to look for a problem in the test case! And of course, the square root of 1000 isn't an integer, so there is no way this code can return 1. If we change the 1000 to 100, KLEE finds two paths as we would expect:</div><div><pre>$ cat t.c<br>#include "klee/klee.h"<br><br>int f0(int x) {<br>if (x * x == 100)<br>return 1;<br>else<br>return 0;<br>}<br><br>int main() {<br>return f0(klee_int("x"));<br>}<br>$ clang -I ~/public/klee/include -flto -c t.c<br>$ ~/public/klee.obj.64/Debug/bin/klee t.o<br>KLEE: output directory = "klee-out-6"<br><br>KLEE: done: total instructions = 31<br>KLEE: done: completed paths = 2<br>KLEE: done: generated tests = 2</pre><br></div>This example shows exactly what KLEE was designed for -- reasoning about code (or math) is hard, and it is great to let a machine do it for you!</article><section class=post-nav><ul><li><a href=https://blog.llvm.org/2010/04/amazing-feats-of-clang-error-recovery.html><i class="fa fa-chevron-circle-left"></i> Amazing feats of Clang Error Recovery</a></li><li><a href=https://blog.llvm.org/2010/04/arm-advanced-simd-neon-intrinsics-and.html>ARM Advanced SIMD (NEON) Intrinsics and Types in LLVM <i class="fa fa-chevron-circle-right"></i></a></li></ul></section></main><footer><ul><li><h6>llvm.org |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://blog.llvm.org/index.xml>Subscribe</a></h6></li></ul></footer></div><script src=https://blog.llvm.org/js/scripts.js></script></body></html>