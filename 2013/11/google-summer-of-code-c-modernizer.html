<!doctype html><html lang=en>
<head>
<title>Google Summer of Code: C++ Modernizer Improvements - The LLVM Project Blog</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="LLVM Project News and Details from the Trenches">
<meta name=author content="Guillaume Papin"><meta property="og:title" content="Google Summer of Code: C++ Modernizer Improvements">
<meta property="og:description" content="Google Summer of Code (GSoC) offers students stipends to participate in open source projects during the summer. This year, I was accepted to work on the Clang C++ Modernizer, a project formerly known as the C++11 Migrator, driven by a team at Intel.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.llvm.org/2013/11/google-summer-of-code-c-modernizer.html"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2013-11-18T04:12:00+00:00">
<meta property="article:modified_time" content="2013-11-18T04:12:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Google Summer of Code: C++ Modernizer Improvements">
<meta name=twitter:description content="Google Summer of Code (GSoC) offers students stipends to participate in open source projects during the summer. This year, I was accepted to work on the Clang C++ Modernizer, a project formerly known as the C++11 Migrator, driven by a team at Intel.">
<meta name=generator content="Hugo 0.89.4">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous>
<link rel=stylesheet href=https://blog.llvm.org/fontawesome/css/all.min.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda">
<link rel=stylesheet type=text/css href=https://blog.llvm.org/css/styles.css></head>
<body>
<div id=container>
<header>
<h1>
<a href=https://blog.llvm.org/>The LLVM Project Blog</a>
</h1>
<ul id=social-media>
<li>
<a href=https://www.facebook.com/llvmorg title=Facebook>
<i class="fab fa-facebook fa-lg"></i>
</a>
</li>
<li>
<a href=https://github.com/llvm title=GitHub>
<i class="fab fa-github fa-lg"></i>
</a>
</li>
<li>
<a href=https://twitter.com/llvmorg title=Twitter>
<i class="fab fa-twitter fa-lg"></i>
</a>
</li>
<li>
<a href=https://www.youtube.com/c/LLVMPROJ title=Youtube>
<i class="fab fa-youtube fa-lg"></i>
</a>
</li>
</ul>
<p><em>LLVM Project News and Details from the Trenches</em></p>
</header>
<nav>
<ul>
<li>
<a href=https://blog.llvm.org/about>
<i class="fa-li fa fa-lg"></i><span>About</span>
</a>
</li>
<li>
<a href=https://blog.llvm.org/posts>
<i class="fa-li fa fa-lg"></i><span>Posts</span>
</a>
</li>
<li>
<a href=https://blog.llvm.org/tags>
<i class="fa-li fa fa-lg"></i><span>Tags</span>
</a>
</li>
<li>
<a href=https://llvm.org/>
<i class="fa-li fa fa-lg"></i><span>llvm.org</span>
</a>
</li>
</ul>
</nav>
<main>
<article>
<h1>Google Summer of Code: C++ Modernizer Improvements</h1>
<aside>
<ul>
<li>By Guillaume Papin</li>
<li>
<time class=post-date datetime=2013-11-18T04:12:00Z>Nov 18, 2013</time>
</li>
<li>
<em>
<a href=https://blog.llvm.org/tags/gsoc>#GSoC</a>
,
<a href=https://blog.llvm.org/tags/c++>#C++</a>
,
<a href=https://blog.llvm.org/tags/clang>#Clang</a>
,
<a href=https://blog.llvm.org/tags/modernizer>#modernizer</a>
</em>
</li>
<li>6 minute read</li>
</ul>
</aside>
<div style=text-indent:0><a href=http://www.google-melange.com/gsoc/homepage/google/gsoc2013>Google Summer of Code</a> (GSoC) offers students stipends to participate in open source projects during the summer. This year, I was accepted to work on the <a href=http://clang.llvm.org/extra/clang-modernize.html>Clang C++ Modernizer</a>, a project formerly known as the <i>C++11 Migrator</i>, driven by a team at Intel. The goals of the tool are to modernize C++ code by using the new features of new C++ standards in order to improve maintainability, readability and compile time and runtime performance. The project was featured in the April blog post “<a href=http://blog.llvm.org/2013/04/status-of-c11-migrator.html>Status of the C++11 Migrator</a>” and has been evolving since, both in terms of architecture and features.<br><div><br><div>This article presents the improvements made to the tool in the last few months, which include my work from this summer for GSoC. For a complete overview of the tool and how to install it, please visit the documentation: <a href=http://clang.llvm.org/extra/clang-modernize.html#getting-started>http://clang.llvm.org/extra/clang-modernize.html#getting-started</a>. For a demonstration of the tool you can take a look at the Going Native 2013 talk given by Chandler Carruth: <a href=http://channel9.msdn.com/Events/GoingNative/2013/The-Care-and-Feeding-of-C-s-Dragons>The Care and Feeding of C++'s Dragons</a>. clang-modernize is featured starting at ~33min.<br><div dir=ltr style=line-height:1.15;margin-bottom:0;margin-top:0><span style=background-color:transparent;color:#000;font-family:Arial;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;vertical-align:baseline;white-space:pre-wrap></span><br><a name=more></a></div><h2>Transform <u>all</u> Files That Make up a Translation Unit</h2>A major improvement since the last version is the ability to transform every file that composes a translation unit not only the main source file. This means headers also get transformed if they need to be which makes the modernizer more useful.<br><br>To avoid changing files that shouldn’t be changed, e.g. system headers or headers for third-party libraries, there are a few options to control which files should be transformed:<br><ul><li><a href=http://clang.llvm.org/extra/ModernizerUsage.html#cmdoption-include>-include</a> Takes a comma-separated list of paths allowed to be transformed. All files within the entire directory tree rooted at each given path are marked as modifiable. For safety, the default behaviour is that no extra files will be transformed.</li><li><a href=http://clang.llvm.org/extra/ModernizerUsage.html#cmdoption-exclude>-exclude</a> Takes a comma-separated list of paths forbidden to be transformed. Can be used to prune out subtrees from included directory trees.</li><li><a href=http://clang.llvm.org/extra/ModernizerUsage.html#cmdoption-include-from>-include-from</a> and <a href=http://clang.llvm.org/extra/ModernizerUsage.html#cmdoption-exclude-from>-exclude-from</a> Respectively equivalent to -include and -exclude but takes a filename as argument instead of a comma-separated list of paths. The file should contain one path per line.</li></ul>Example, assuming a directory hierarchy of:<br><ul><li>src/foo.cpp</li><li>include/foo.h</li><li>lib/third-party.h</li></ul>to transform both <i>foo.cpp</i> and <i>foo.h</i> but leave <i>third-party.h</i> as is, you can use one of the following commands:<br><div style=padding-left:25px><pre style=color:#555>clang-modernize -include=include/ src/foo.cpp -- -std=c++11 -I include/ -I lib/</pre><pre style=color:#555>clang-modernize -include=. -exclude=lib/ src/foo.cpp -- -std=c++11 -I include/ -I lib/</pre></div><h2>The Transforms</h2>Right now there is a total of 6 transforms, two of which are new:<br><ol><li><a href=http://clang.llvm.org/extra/AddOverrideTransform.html>Add-Override Transform</a><br>Adds the ‘override’ specifier to overriden member functions.</li><li><a href=http://clang.llvm.org/extra/LoopConvertTransform.html>Loop Convert Transform</a><br>Makes use of for-ranged based loop.</li><li><a href=http://clang.llvm.org/extra/PassByValueTransform.html>Pass-By-Value Transform</a> [new]<br>Replaces const-ref parameters that would benefit from using the pass-by-value idiom.</li><li><a href=http://clang.llvm.org/extra/ReplaceAutoPtrTransform.html>Replace Auto-Ptr Transform</a> [new]<br>Replaces uses of the deprecated <tt>std::auto_ptr</tt> by <tt>std::unique_ptr</tt>.</li><li><a href=http://clang.llvm.org/extra/UseAutoTransform.html>Use-Auto Transform</a><br>Makes use of the auto type specifier in variable declarations.</li><li><a href=http://clang.llvm.org/extra/UseNullptrTransform.html>Use-Nullptr Transform</a><br>Replaces null literals and macros by nullptr where applicable.</li></ol><h3>Improvement to Add-Override</h3>Since the last article in April, the Add-Override Transform has been improved to handle user-defined macros. Some projects, like LLVM, use a macro that expands to the ‘override’ specifier for backward compatibility with non-C++11-compliant compilers. clang-modernize can detect those macros and use them instead of the ‘override’ identifier.<br><br>The command line switch to enable this functionality is <b>-override-macros</b>.<br><br>Example:<br><br><div style=padding-left:25px><tt>clang-modernize <b>-override-macros</b> foo.cpp</tt></div><div><span style=font-size:15px;white-space:pre-wrap></span><br><div dir=ltr><table style=border-collapse:collapse;border:none;width:624px><col width=*></col><col width=*></col><tbody><tr style=height:0><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0><span style=font-size:15px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>Before</span></div></td><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0><span style=font-size:15px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>After</span></div></td></tr><tr style=height:0><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>#define LLVM_OVERRIDE override</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap><span style=color:#007020><br class=kix-line-break></span></span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>struct</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> A {<br class=kix-line-break> &nbsp;</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>virtual</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> foo();<br class=kix-line-break>};</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap><br></span></span><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>struct</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> B </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>:</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> A {<br class=kix-line-break> &nbsp;</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>virtual</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> foo();<br class=kix-line-break>};</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap></span></span></div></td><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>#define LLVM_OVERRIDE override</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break></span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap><br></span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>struct</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> A {<br class=kix-line-break> &nbsp;</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>virtual</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> foo();<br class=kix-line-break>};</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap><br></span></span><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>struct</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> B </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>:</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> A {<br class=kix-line-break> &nbsp;</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>virtual</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap> foo() </span><span style=font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>LLVM_OVERRIDE</span><span style=font-size:13px;vertical-align:baseline;white-space:pre-wrap>;<br class=kix-line-break>};</span></span></div></td></tr></tbody></table></div><h3>Improvement to Use-Nullptr</h3>This transform has also been improved to handle user-defined macros that behave like NULL. The user specifies which macros can be replaced by nullptr by using the command line switch <a href=http://clang.llvm.org/extra/ModernizerUsage.html#cmdoption-user-null-macros>-user-null-macros=&lt;string></a>.<br><br>Example:<br><br><div style=padding-left:25px><tt>clang-modernize <b>-user-null-macros=MY_NULL</b> bar.cpp</tt></div><span style=font-size:15px;white-space:pre-wrap></span><br><div dir=ltr><table style=border-collapse:collapse;border:none;width:624px><col width=*></col><col width=*></col><tbody><tr style=height:0><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0><span style=font-family:Arial;font-size:15px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>Before</span></div></td><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0><span style=font-family:Arial;font-size:15px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>After</span></div></td></tr><tr style=height:0><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:8pt;margin-top:11pt><span style="color:#007020;font-family:courier new,Courier,monospace;font-size:13px;line-height:1;white-space:pre-wrap">#define MY_NULL 0</span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break></span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#06287e;font-size:13px;vertical-align:baseline;white-space:pre-wrap>bar</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>() {<br class=kix-line-break> &nbsp;</span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>*</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>p </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>=</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> MY_NULL;<br class=kix-line-break>}</span></span></div></td><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br></span></span><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>#define MY_NULL 0</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break></span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#06287e;font-size:13px;vertical-align:baseline;white-space:pre-wrap>bar</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>() {<br class=kix-line-break> &nbsp;</span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>*</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>p </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>=</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>nullptr</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>;<br class=kix-line-break>}</span></span></div></td></tr></tbody></table></div><h3> New Transform: Replace Auto-Ptr</h3>This transform was a result of GSoC work. The transform replaces uses of <tt>std::auto_ptr</tt> by <tt>std::unique_ptr</tt>. It also inserts calls to <tt>std::move()</tt> when needed.<br><span style=font-size:15px;white-space:pre-wrap></span><br><div dir=ltr><table style=border-collapse:collapse;border:none;width:624px><col width=*></col><col width=*></col><tbody><tr style=height:0><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0><span style=font-family:Arial;font-size:15px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>Before</span></div></td><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0><span style=font-family:Arial;font-size:15px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>After</span></div></td></tr><tr style=height:0><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:8pt;margin-top:11pt><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>#include &lt;memory></span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break></span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#06287e;font-size:13px;vertical-align:baseline;white-space:pre-wrap>steal</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>(std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>auto_ptr</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>&lt;</span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>></span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> x);</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br></span></span><span style="font-family:Courier New,Courier,monospace"><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#06287e;font-size:13px;vertical-align:baseline;white-space:pre-wrap>foo</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>(</span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> i) {<br class=kix-line-break> &nbsp;std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>auto_ptr</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>&lt;</span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>></span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> p(</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>new</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>(i));<br class=kix-line-break><br class=kix-line-break> &nbsp;steal(p);<br class=kix-line-break>}</span></span></div></td><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:8pt;margin-top:11pt><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>#include &lt;memory></span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break></span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#06287e;font-size:13px;vertical-align:baseline;white-space:pre-wrap>steal</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>(std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>unique_ptr</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>&lt;</span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>></span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> x);</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br></span></span><span style="font-family:Courier New,Courier,monospace"><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>void</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#06287e;font-size:13px;vertical-align:baseline;white-space:pre-wrap>foo</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>(</span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> i) {<br class=kix-line-break> &nbsp;std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>unique_ptr</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>&lt;</span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>></span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> p(</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>new</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#902000;font-size:13px;vertical-align:baseline;white-space:pre-wrap>int</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>(i));<br class=kix-line-break><br class=kix-line-break> &nbsp;steal(</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>std</span><span style=color:#666;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>move(</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>p</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>)</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>);<br class=kix-line-break>}</span></span></div></td></tr></tbody></table></div><h3>New Transform: Pass-By-Value</h3>Also a product of GSoC this transform makes use of move semantics added in C++11 to avoid a copy for functions that accept types that have move constructors by const reference. By changing to pass-by-value semantics, a copy can be avoided if an rvalue argument is provided. For lvalue arguments, the number of copies remains unchanged.<br><br>The transform is currently limited to constructor parameters that are copied into class fields.<br><br>Example:<br><br><div style=padding-left:25px><tt>clang-modernize pass-by-value.cpp</tt></div><br><div><div dir=ltr style=color:#000;font-weight:400><table style=border-collapse:collapse;border:none;width:624px><col width=*></col><col width=*></col><tbody><tr style=height:0><td style="border:1px solid #000;padding:7px;vertical-align:top"><b>Before</b></td><td style="border:1px solid #000;padding:7px;vertical-align:top"><b>After</b><br><div dir=ltr style=line-height:1;margin-bottom:0;margin-top:0></div></td></tr><tr style=height:0><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:8pt;margin-top:11pt><div><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>#include &lt;string></span></span></div><div><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap><br></span></span></div><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>class</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#0e84b5;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>A</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> {</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#002070;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>public:</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break> &nbsp;A(</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>const</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>string &Copied,</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>const</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>string </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>&</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>ReadOnly)<br class=kix-line-break> &nbsp;&nbsp;&nbsp;</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>:</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> Copied(Copied),</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> ReadOnly(ReadOnly) {}</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#002070;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap><br></span></span><span style="font-family:Courier New,Courier,monospace"><span style=color:#002070;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>private:</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break> &nbsp;std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>string Copied;<br class=kix-line-break> &nbsp;</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>const</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>string </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>&</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>ReadOnly;<br class=kix-line-break>};</span></span></div></td><td style="border:1px solid #000;padding:7px;vertical-align:top"><div dir=ltr style=line-height:1;margin-bottom:8pt;margin-top:11pt><span style="color:#007020;font-family:courier new,Courier,monospace;font-size:13px;line-height:1;white-space:pre-wrap">#include &lt;string></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>#include &lt;utility></span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><u><br class=kix-line-break></u></span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>class</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> </span><span style=color:#0e84b5;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>A</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> {</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#002070;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>public:</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break> &nbsp;A(</span><span style=color:#007020;font-size:13px;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>std</span><span style=color:#666;font-size:13px;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>string</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> Copied,</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap> const</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>string </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>&</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>ReadOnly)<br class=kix-line-break> &nbsp;&nbsp;&nbsp;</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>:</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> Copied(</span><span style=color:#007020;font-size:13px;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>std</span><span style=color:#666;font-size:13px;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>move(</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>Copied</span><span style=color:#007020;font-size:13px;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap>)</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>),</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> ReadOnly(ReadOnly) {}</span></span><br><span style="font-family:Courier New,Courier,monospace"><span style=color:#002070;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap><br></span></span><span style="font-family:Courier New,Courier,monospace"><span style=color:#002070;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>private:</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap><br class=kix-line-break> &nbsp;std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>string Copied;<br class=kix-line-break> &nbsp;</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline;white-space:pre-wrap>const</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap> std</span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>::</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>string </span><span style=color:#666;font-size:13px;vertical-align:baseline;white-space:pre-wrap>&</span><span style=color:#007020;font-size:13px;vertical-align:baseline;white-space:pre-wrap>ReadOnly;<br class=kix-line-break>};</span></span></div></td></tr></tbody></table></div></div><br><tt>std::move()</tt> is a library function declared in <tt>&lt;utility></tt>. If need be, this header is added by clang-modernize.<br><br>There is a lot of room for improvement in this transform. Other situations that are safe to transform likely exist. Contributions are most welcomed in this area! <br><div><h2>Usability Improvements</h2>We also worked hard on improving the overall usability of the modernizer. Invoking the modernizer now requires fewer arguments since most of the time the arguments can be inferred. <br><ul><li>If no compilation database or flags are provided, -std=c++11 is assumed.</li><li>All transforms are enabled by default.</li><li>Files don’t need to be explicitly listed if a compilation database is provided. The modernizer will get files from the compilation database. Use -include to choose which ones.</li></ul>Two new features were also added.<br><ol><li>Automatically reformat code affected by transforms using <a href=http://clang.llvm.org/docs/LibFormat.html>LibFormat</a>.</li><li>A new command line switch to choose transforms to apply based on compiler support.</li></ol><h3>Reformatting Transformed Code</h3><a href=http://clang.llvm.org/docs/LibFormat.html>LibFormat</a> is the library used behind the scenes by <a href=http://clang.llvm.org/docs/ClangFormat.html>clang-format</a>, a tool to format C, C++ and Obj-C code. <i>clang-modernize</i> uses this library as well to reformat transformed code. When enabled with -format, the default style is LLVM. The -style option can control the style in a way identical to clang-format.<br><br>Example:</div><div><b><br></b></div><div><b>format.cpp</b></div><div><div dir=ltr style=margin-bottom:8pt;margin-left:36pt;margin-top:11pt><div><span id=docs-internal-guid-65d203ed-13ad-2ddb-d832-4912cc50e162><span style="background-color:transparent;color:#000;font-family:Courier New,Courier,monospace;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;line-height:1.15;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><span style=color:#007020;font-size:13px;vertical-align:baseline>#include &lt;iostream></span><span style=font-size:13px;vertical-align:baseline><br class=kix-line-break></span><span style=color:#007020;font-size:13px;vertical-align:baseline>#include &lt;vector></span></span></span></div><div style=font-weight:400;line-height:1.15><span style=background-color:transparent;font-size:15px;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap><span id=docs-internal-guid-65d203ed-13ad-2ddb-d832-4912cc50e162><span style="font-family:Courier New,Courier,monospace"><span style=font-size:13px;vertical-align:baseline><span style=color:#007020><br class=kix-line-break></span></span><span style=color:#902000;font-size:13px;vertical-align:baseline>void</span><span style=color:#000;font-size:13px;vertical-align:baseline> </span><span style=color:#06287e;font-size:13px;vertical-align:baseline>f</span><span style=color:#000;font-size:13px;vertical-align:baseline>(</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline>const</span><span style=color:#000;font-size:13px;vertical-align:baseline> std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>vector</span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;</span><span style=color:#902000;font-size:13px;vertical-align:baseline>int</span><span style=color:#666;font-size:13px;vertical-align:baseline>></span><span style=color:#000;font-size:13px;vertical-align:baseline> </span><span style=color:#666;font-size:13px;vertical-align:baseline>&</span><span style=color:#000;font-size:13px;vertical-align:baseline>my_container) {<br class=kix-line-break> &nbsp;</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline>for</span><span style=color:#000;font-size:13px;vertical-align:baseline> (std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>vector</span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;</span><span style=color:#902000;font-size:13px;vertical-align:baseline>int</span><span style=color:#666;font-size:13px;vertical-align:baseline>>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>const_iterator I </span><span style=color:#666;font-size:13px;vertical-align:baseline>=</span><span style=color:#000;font-size:13px;vertical-align:baseline> my_container.begin(),<br class=kix-line-break> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E </span><span style=color:#666;font-size:13px;vertical-align:baseline>=</span><span style=color:#000;font-size:13px;vertical-align:baseline> my_container.end();<br class=kix-line-break> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I </span><span style=color:#666;font-size:13px;vertical-align:baseline>!=</span><span style=color:#000;font-size:13px;vertical-align:baseline> E; </span><span style=color:#666;font-size:13px;vertical-align:baseline>++</span><span style=color:#000;font-size:13px;vertical-align:baseline>I) {<br class=kix-line-break> &nbsp;&nbsp;&nbsp;std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>cout </span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;&lt;</span><span style=color:#000;font-size:13px;vertical-align:baseline> </span><span style=color:#666;font-size:13px;vertical-align:baseline>*</span><span style=color:#000;font-size:13px;vertical-align:baseline>I </span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;&lt;</span><span style=color:#000;font-size:13px;vertical-align:baseline> std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>endl;<br class=kix-line-break> &nbsp;}<br class=kix-line-break>}</span></span></span></span></div></div><br><b>Without reformatting</b><br><br><div style=padding-left:10px><tt>$ clang-modernize -use-auto format.cpp</tt></div><div dir=ltr style=margin-bottom:8pt;margin-left:36pt;margin-top:11pt><div><span style=background-color:transparent;font-size:15px;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap><span id=docs-internal-guid-65d203ed-13ad-2ddb-d832-4912cc50e162><span style="font-family:Courier New,Courier,monospace"><span style=color:#007020;font-size:13px;vertical-align:baseline>#include &lt;iostream></span><span style=font-size:13px;vertical-align:baseline><br class=kix-line-break></span><span style=color:#007020;font-size:13px;vertical-align:baseline>#include &lt;vector></span></span></span></span></div><div style=font-weight:400;line-height:1.15><span style=background-color:transparent;font-size:15px;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap><span id=docs-internal-guid-65d203ed-13ad-2ddb-d832-4912cc50e162><span style="font-family:Courier New,Courier,monospace"><span style=font-size:13px;vertical-align:baseline><span style=color:#007020><br class=kix-line-break></span></span><span style=color:#902000;font-size:13px;vertical-align:baseline>void</span><span style=color:#000;font-size:13px;vertical-align:baseline> </span><span style=color:#06287e;font-size:13px;vertical-align:baseline>f</span><span style=color:#000;font-size:13px;vertical-align:baseline>(</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline>const</span><span style=color:#000;font-size:13px;vertical-align:baseline> std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>vector</span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;</span><span style=color:#902000;font-size:13px;vertical-align:baseline>int</span><span style=color:#666;font-size:13px;vertical-align:baseline>></span><span style=color:#000;font-size:13px;vertical-align:baseline> </span><span style=color:#666;font-size:13px;vertical-align:baseline>&</span><span style=color:#000;font-size:13px;vertical-align:baseline>my_container) {<br class=kix-line-break> &nbsp;</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline>for</span><span style=color:#000;font-size:13px;vertical-align:baseline> (</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline>auto</span><span style=color:#000;font-size:13px;vertical-align:baseline> I </span><span style=color:#666;font-size:13px;vertical-align:baseline>=</span><span style=color:#000;font-size:13px;vertical-align:baseline> my_container.begin(),<br class=kix-line-break> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E </span><span style=color:#666;font-size:13px;vertical-align:baseline>=</span><span style=color:#000;font-size:13px;vertical-align:baseline> my_container.end();<br class=kix-line-break> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I </span><span style=color:#666;font-size:13px;vertical-align:baseline>!=</span><span style=color:#000;font-size:13px;vertical-align:baseline> E; </span><span style=color:#666;font-size:13px;vertical-align:baseline>++</span><span style=color:#000;font-size:13px;vertical-align:baseline>I) {<br class=kix-line-break> &nbsp;&nbsp;&nbsp;std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>cout </span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;&lt;</span><span style=color:#000;font-size:13px;vertical-align:baseline> </span><span style=color:#666;font-size:13px;vertical-align:baseline>*</span><span style=color:#000;font-size:13px;vertical-align:baseline>I </span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;&lt;</span><span style=color:#000;font-size:13px;vertical-align:baseline> std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>endl;<br class=kix-line-break> &nbsp;}<br class=kix-line-break>}</span></span></span></span></div></div><br><b>With reformatting</b><br><br><div style=padding-left:10px><tt>$ clang-modernize -format -style=LLVM -use-auto format.cpp</tt></div><div dir=ltr style=margin-bottom:8pt;margin-left:36pt;margin-top:11pt><div><span id=docs-internal-guid-65d203ed-13ad-2ddb-d832-4912cc50e162><span style="background-color:transparent;color:#000;font-family:Courier New,Courier,monospace;font-size:15px;font-style:normal;font-variant:normal;font-weight:400;line-height:1.15;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><span style=color:#007020;font-size:13px;vertical-align:baseline>#include &lt;iostream></span><span style=font-size:13px;vertical-align:baseline><br class=kix-line-break></span><span style=color:#007020;font-size:13px;vertical-align:baseline>#include &lt;vector></span></span></span></div><div style=font-weight:400;line-height:1.15><span style=background-color:transparent;font-size:15px;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap><span id=docs-internal-guid-65d203ed-13ad-2ddb-d832-4912cc50e162><span style="font-family:Courier New,Courier,monospace"><span style=font-size:13px;vertical-align:baseline><span style=color:#007020><br class=kix-line-break></span></span><span style=color:#902000;font-size:13px;vertical-align:baseline>void</span><span style=color:#000;font-size:13px;vertical-align:baseline> </span><span style=color:#06287e;font-size:13px;vertical-align:baseline>f</span><span style=color:#000;font-size:13px;vertical-align:baseline>(</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline>const</span><span style=color:#000;font-size:13px;vertical-align:baseline> std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>vector</span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;</span><span style=color:#902000;font-size:13px;vertical-align:baseline>int</span><span style=color:#666;font-size:13px;vertical-align:baseline>></span><span style=color:#000;font-size:13px;vertical-align:baseline> </span><span style=color:#666;font-size:13px;vertical-align:baseline>&</span><span style=color:#000;font-size:13px;vertical-align:baseline>my_container) {<br class=kix-line-break> &nbsp;</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline>for</span><span style=color:#000;font-size:13px;vertical-align:baseline> (</span><span style=color:#007020;font-size:13px;font-weight:700;vertical-align:baseline>auto</span><span style=color:#000;font-size:13px;vertical-align:baseline> I </span><span style=color:#666;font-size:13px;vertical-align:baseline>=</span><span style=color:#000;font-size:13px;vertical-align:baseline> my_container.begin(), E </span><span style=color:#666;font-size:13px;vertical-align:baseline>=</span><span style=color:#000;font-size:13px;vertical-align:baseline> my_container.end(); I </span><span style=color:#666;font-size:13px;vertical-align:baseline>!=</span><span style=color:#000;font-size:13px;vertical-align:baseline> E; </span><span style=color:#666;font-size:13px;vertical-align:baseline>++</span><span style=color:#000;font-size:13px;vertical-align:baseline>I) {<br class=kix-line-break> &nbsp;&nbsp;&nbsp;std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>cout </span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;&lt;</span><span style=color:#000;font-size:13px;vertical-align:baseline> </span><span style=color:#666;font-size:13px;vertical-align:baseline>*</span><span style=color:#000;font-size:13px;vertical-align:baseline>I </span><span style=color:#666;font-size:13px;vertical-align:baseline>&lt;&lt;</span><span style=color:#000;font-size:13px;vertical-align:baseline> std</span><span style=color:#666;font-size:13px;vertical-align:baseline>::</span><span style=color:#000;font-size:13px;vertical-align:baseline>endl;<br class=kix-line-break> &nbsp;}<br class=kix-line-break>}</span></span></span></span></div></div><br>For more information about this option, take a look at the documentation: <a href=http://clang.llvm.org/extra/ModernizerUsage.html#formatting-command-line-options style=vertical-align:baseline>Formatting Command Line Options</a>.<br><h3>Choosing Transforms based on Compiler Support</h3>Another useful command-line switch is: <a href=http://clang.llvm.org/extra/ModernizerUsage.html#for-compilers-option>-for-compilers</a>. This option enables all transforms the given compilers support.<br><br>As an example, imagine that your project dropped a dependency to a “legacy” version of a compiler. You can automagically modernize your code to the new minimum versions of the compilers you want to support:<br><br>To support Clang >= 3.1, GCC >= 4.6 and MSVC 11:<br><br><div style=padding-left:25px><pre>clang-modernize -format -for-compilers=clang-3.1,gcc-4.6,msvc-11 foo.cpp</pre></div><br>For more information about this option and to see which transforms are available for each compilers, please read <a href=http://clang.llvm.org/extra/ModernizerUsage.html#cmdoption-for-compilers>the documentation</a>.<br><h2> What’s next?</h2>The ability to transform many translation units in parallel will arrive very soon. Think of <i>clang-modernize -j</i> as in make and ninja. Modernization of large code bases will become much faster as a result.<br><br>More transforms are coming down the pipe as well as improvements to existing transforms such as the pass-by-value transform.<br><br>We will continue fixing bugs and adding new features. Our backlog is publically available: <a href="https://cpp11-migrate.atlassian.net/secure/RapidBoard.jspa?rapidView=1&view=planning">https://cpp11-migrate.atlassian.net/secure/RapidBoard.jspa?rapidView=1&view=planning</a><br><h2>Get involved!</h2>Interested by the tool? Found a bug? Have an idea of a transform that can be useful to others? The project is Open Source and contributions are most welcomed!<br><br>The modernizer has its own bug and project tracker. If you want to file or fix a bug just go to: <a href=https://cpp11-migrate.atlassian.net/>https://cpp11-migrate.atlassian.net</a><br><br>A few other addresses to keep in mind: <br><ul><li><a href=http://clang.llvm.org/extra/clang-modernize.html>Clang C++ Modernizer User’s Manual</a></li><li>IRC channel: #llvm on irc.oftc.net</li><li>Mailing lists:</li><ul><li><a href=http://lists.cs.uiuc.edu/mailman/listinfo/cfe-dev>cfe-dev</a> for questions and general discussions</li><li><a href=http://lists.cs.uiuc.edu/mailman/listinfo/cfe-commits>cfe-commits</a> for patches</li></ul><li><a href=http://llvm-reviews.chandlerc.com/>Phabricator</a> to submit patches</li></ul><h2> Final word</h2>Finally I want to thank my mentor Edwin Vane and his team at Intel, Tareq Siraj and Ariel Bernal, for the great support they provided me. Also thanks to the LLVM community and Google Summer of Code team for giving me this opportunity to work on the C++ Modernizer this summer.<br><br>-- Guillaume Papin</div></div></div></div></div>
</article>
<section class=post-nav>
<ul>
<li>
<a href=https://blog.llvm.org/2013/11/the-clang-cl-fallback-mode.html><i class="fa fa-chevron-circle-left"></i> The clang-cl /fallback mode</a>
</li>
<li>
<a href=https://blog.llvm.org/2014/01/llvm-weekly-2-jan-13th-2014.html>LLVM Weekly - #2, Jan 13th 2014 <i class="fa fa-chevron-circle-right"></i> </a>
</li>
</ul>
</section>
</main>
<footer>
<ul>
<li>
<h6>llvm.org |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://blog.llvm.org/index.xml>Subscribe </a></h6>
</li>
</ul>
</footer>
</div>
<script src=https://blog.llvm.org/js/scripts.js></script>
</body>
</html>